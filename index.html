<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Villa13 - Cinayet KeÅŸif Oyunu</title>
    <style>
        /* ===== GENEL STIL AYARLARI =====
           NOT: Bu bÃ¶lÃ¼mden sitenin genel stilini ve renklerini deÄŸiÅŸtirebilirsiniz */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; /* NOT: Font ailesini buradan deÄŸiÅŸtirebilirsiniz */
            -webkit-tap-highlight-color: transparent; /* Mobil dokunmalarda vurgu efektini kaldÄ±r */
        }
        
        body {
            background-color: #1a1a1a; /* NOT: Sayfa arka plan rengini buradan deÄŸiÅŸtirebilirsiniz */
            color: white; /* NOT: Metin rengini buradan deÄŸiÅŸtirebilirsiniz */
            overflow-x: hidden;
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            padding: 20px;
            position: relative;
        }
        
        /* ===== BAÅLIK STILI =====
           NOT: Sayfa baÅŸlÄ±ÄŸÄ±nÄ±n gÃ¶rÃ¼nÃ¼mÃ¼nÃ¼ buradan dÃ¼zenleyebilirsiniz */
        h1 {
            text-align: center;
            margin: 20px 0;
            color: #ff4d4d; /* NOT: BaÅŸlÄ±k rengini buradan deÄŸiÅŸtirebilirsiniz */
            font-size: 2rem; /* NOT: BaÅŸlÄ±k puntosunu buradan deÄŸiÅŸtirebilirsiniz */
            text-shadow: 0 0 10px rgba(255, 77, 77, 0.5); /* NOT: BaÅŸlÄ±k gÃ¶lgesini buradan deÄŸiÅŸtirebilirsiniz */
        }
        
        /* ===== GÄ°RÄ°Å EKRANI STILI =====
           NOT: GiriÅŸ ekranÄ±nÄ±n gÃ¶rÃ¼nÃ¼mÃ¼nÃ¼ buradan dÃ¼zenleyebilirsiniz */
        .splash-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: #1a1a1a;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            background-image: linear-gradient(rgba(0, 0, 0, 0.7), rgba(0, 0, 0, 0.7)), url('https://placehold.co/1200x800/333/white?text=Villa13'); /* NOT: GiriÅŸ ekranÄ± arka plan resmini buradan deÄŸiÅŸtirebilirsiniz */
            background-size: cover;
            background-position: center;
            padding: 20px;
        }
        
        .splash-content {
            background-color: rgba(10, 10, 10, 0.8); /* NOT: GiriÅŸ ekranÄ± iÃ§erik arka planÄ±nÄ± buradan deÄŸiÅŸtirebilirsiniz */
            border-radius: 15px;
            padding: 30px;
            width: 90%;
            max-width: 500px;
            text-align: center;
            box-shadow: 0 0 25px rgba(255, 77, 77, 0.3); /* NOT: GiriÅŸ ekranÄ± gÃ¶lgesini buradan deÄŸiÅŸtirebilirsiniz */
        }
        
        .splash-title {
            color: #ff4d4d; /* NOT: GiriÅŸ ekranÄ± baÅŸlÄ±k rengini buradan deÄŸiÅŸtirebilirsiniz */
            font-size: 2.5rem; /* NOT: GiriÅŸ ekranÄ± baÅŸlÄ±k puntosunu buradan deÄŸiÅŸtirebilirsiniz */
            margin-bottom: 20px;
            text-shadow: 0 0 10px rgba(255, 77, 77, 0.5);
        }
        
        .splash-description {
            font-size: 1.2rem; /* NOT: GiriÅŸ ekranÄ± aÃ§Ä±klama puntosunu buradan deÄŸiÅŸtirebilirsiniz */
            margin-bottom: 30px;
            line-height: 1.6;
        }
        
        /* ===== OYUN BAÅLAT BUTONU STILI =====
           NOT: Oyun baÅŸlatma butonunun gÃ¶rÃ¼nÃ¼mÃ¼nÃ¼ buradan dÃ¼zenleyebilirsiniz */
        .start-game-btn {
            background-color: #ff4d4d; /* NOT: Buton rengini buradan deÄŸiÅŸtirebilirsiniz */
            color: white; /* NOT: Buton yazÄ± rengini buradan deÄŸiÅŸtirebilirsiniz */
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 10px;
        }
        
        .start-game-btn:hover {
            background-color: #ff3333; /* NOT: Buton hover rengini buradan deÄŸiÅŸtirebilirsiniz */
            transform: scale(1.05);
        }
        
        /* ===== FORM ALANI STILI =====
           NOT: Oyun baÅŸÄ±nda isim gireceÄŸiniz form alanÄ± */
        .player-form {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .player-form input {
            padding: 12px;
            border-radius: 8px;
            border: none;
            background-color: #333; /* NOT: Form input arka plan rengini buradan deÄŸiÅŸtirebilirsiniz */
            color: white; /* NOT: Form input yazÄ± rengini buradan deÄŸiÅŸtirebilirsiniz */
            font-size: 1rem;
        }
        
        /* ===== ZAMANLAYICI STILI =====
           NOT: SaÄŸ Ã¼stteki oyun zamanlayÄ±cÄ± stili */
        .game-timer {
            position: fixed;
            top: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.7); /* NOT: ZamanlayÄ±cÄ± arka plan rengini buradan deÄŸiÅŸtirebilirsiniz */
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 1.2rem;
            z-index: 100;
        }
        
        /* ===== OYUNCU BÄ°LGÄ°SÄ° STILI =====
           NOT: Sol Ã¼stteki oyuncu bilgisi stili */
        .player-info {
            position: fixed;
            top: 10px;
            left: 10px;
            background-color: rgba(0, 0, 0, 0.7); /* NOT: Oyuncu bilgisi arka plan rengini buradan deÄŸiÅŸtirebilirsiniz */
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 1rem;
            z-index: 100;
        }
        
        /* ===== KAT GÃ–RÃœNÃœMÃœ STILI =====
           NOT: Kat planlarÄ±nÄ±n gÃ¶sterildiÄŸi alan stili */
        .floor-view {
            position: relative;
            max-width: 100%;
            margin: 0 auto;
            overflow: hidden;
            touch-action: manipulation;
        }
        
        .floor-image {
            width: 100%;
            height: auto;
            display: block;
            border: 2px solid #444; /* NOT: Kat planÄ± Ã§erÃ§eve rengini buradan deÄŸiÅŸtirebilirsiniz */
            border-radius: 8px;
            transition: transform 0.3s ease;
            pointer-events: none; /* GÃ¶rsel Ã¼zerinde tÄ±klama alanlarÄ±nÄ± engelleme */
        }
        
        /* ===== KAT SEÃ‡Ä°M BUTONLARI STILI =====
           NOT: Katlar arasÄ± geÃ§iÅŸ butonlarÄ± stili */
        .floor-nav {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            gap: 20px;
        }
        
        .floor-btn {
            padding: 12px 30px;
            background-color: #333; /* NOT: Kat seÃ§im butonu arka plan rengini buradan deÄŸiÅŸtirebilirsiniz */
            color: white; /* NOT: Kat seÃ§im butonu yazÄ± rengini buradan deÄŸiÅŸtirebilirsiniz */
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.2rem;
            font-weight: bold;
            transition: all 0.3s ease;
        }
        
        .floor-btn:hover {
            background-color: #444; /* NOT: Kat seÃ§im butonu hover rengini buradan deÄŸiÅŸtirebilirsiniz */
        }
        
        .floor-btn.active {
            background-color: #ff4d4d; /* NOT: Aktif kat seÃ§im butonu rengini buradan deÄŸiÅŸtirebilirsiniz */
            color: white;
            box-shadow: 0 0 15px rgba(255, 77, 77, 0.5);
        }
        
        /* ===== ODA ALANLARI STILI =====
           NOT: Kat planÄ± Ã¼zerindeki tÄ±klanabilir oda alanlarÄ± stili */
        .room {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.05); /* NOT: Oda alanÄ± arka plan rengini buradan deÄŸiÅŸtirebilirsiniz */
            border: 1px dashed rgba(255, 255, 255, 0.1); /* NOT: Oda alanÄ± Ã§erÃ§eve rengini buradan deÄŸiÅŸtirebilirsiniz */
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 4px;
            z-index: 10;
        }
        
        .room:hover {
            background-color: rgba(255, 255, 255, 0.2); /* NOT: Oda alanÄ± hover arka plan rengini buradan deÄŸiÅŸtirebilirsiniz */
            border-color: rgba(255, 255, 255, 0.3); /* NOT: Oda alanÄ± hover Ã§erÃ§eve rengini buradan deÄŸiÅŸtirebilirsiniz */
        }
        
        /* Hotspot AlanlarÄ± (Odalar) */
        .room {
            position: absolute;
            background-color: rgba(255, 255, 255, 0.05);
            border: 1px dashed rgba(255, 255, 255, 0.1);
            cursor: pointer;
            transition: all 0.3s ease;
            border-radius: 4px;
            z-index: 10;
        }
        
        .room:hover {
            background-color: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }
        
        /* ===== ARAMA MODAL STILI =====
           NOT: Oda aramasÄ± iÃ§in aÃ§Ä±lan pencere stili */
        .search-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8); /* NOT: Modal arka plan transparanlÄ±ÄŸÄ±nÄ± buradan deÄŸiÅŸtirebilirsiniz */
            z-index: 999;
            justify-content: center;
            align-items: center;
            flex-direction: column;
            text-align: center;
        }
        
        .modal-content {
            background-color: #333; /* NOT: Modal iÃ§erik arka plan rengini buradan deÄŸiÅŸtirebilirsiniz */
            padding: 30px;
            border-radius: 15px;
            max-width: 80%;
            box-shadow: 0 0 25px rgba(255, 77, 77, 0.3); /* NOT: Modal gÃ¶lgesini buradan deÄŸiÅŸtirebilirsiniz */
        }
        
        .room-name {
            font-size: 2rem; /* NOT: Oda adÄ± puntosunu buradan deÄŸiÅŸtirebilirsiniz */
            margin-bottom: 20px;
            color: #ff4d4d; /* NOT: Oda adÄ± rengini buradan deÄŸiÅŸtirebilirsiniz */
        }
        
        .timer {
            font-size: 2.5rem; /* NOT: ZamanlayÄ±cÄ± puntosunu buradan deÄŸiÅŸtirebilirsiniz */
            margin: 20px 0;
            font-weight: bold;
        }
        
        .search-text {
            font-size: 1.5rem; /* NOT: Arama metni puntosunu buradan deÄŸiÅŸtirebilirsiniz */
            margin-bottom: 10px;
        }
        
        .start-search-btn {
            background-color: #ff4d4d; /* NOT: Arama baÅŸlat butonu rengini buradan deÄŸiÅŸtirebilirsiniz */
            color: white; /* NOT: Arama baÅŸlat butonu yazÄ± rengini buradan deÄŸiÅŸtirebilirsiniz */
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1.2rem;
            margin-top: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
        }
        
        .start-search-btn:hover {
            background-color: #ff3333; /* NOT: Arama baÅŸlat butonu hover rengini buradan deÄŸiÅŸtirebilirsiniz */
            transform: scale(1.05);
        }
        
        /* ===== Ä°PUÃ‡LARI STILI =====
           NOT: Arama tamamlandÄ±ÄŸÄ±nda gÃ¶sterilen ipuÃ§larÄ± kutularÄ± stili */
        .clues-container {
            display: none;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin-top: 20px;
        }
        
        .clue {
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
            width: 150px; /* NOT: Ä°pucu kutusu geniÅŸliÄŸini buradan deÄŸiÅŸtirebilirsiniz */
            height: 150px; /* NOT: Ä°pucu kutusu yÃ¼ksekliÄŸini buradan deÄŸiÅŸtirebilirsiniz */
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 0 15px rgba(0, 0, 0, 0.5); /* NOT: Ä°pucu kutusu gÃ¶lgesini buradan deÄŸiÅŸtirebilirsiniz */
        }
        
        .clue img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s ease;
            display: block;
        }
        
        .clue:hover img {
            transform: scale(1.1); /* NOT: Ä°pucu kutusu resmi hover efektini buradan deÄŸiÅŸtirebilirsiniz */
        }
        
        .clue-name {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 10px;
            background-color: rgba(0, 0, 0, 0.7); /* NOT: Ä°pucu adÄ± arka plan rengini buradan deÄŸiÅŸtirebilirsiniz */
            text-align: center;
            font-weight: bold;
        }
        
        /* ===== ZOOM BUTONLARI STILI =====
           NOT: SaÄŸ alttaki zoom kontrol butonlarÄ± stili */
        .zoom-controls {
            position: absolute;
            bottom: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }
        
        .zoom-btn {
            background-color: rgba(0, 0, 0, 0.6); /* NOT: Zoom butonu arka plan rengini buradan deÄŸiÅŸtirebilirsiniz */
            color: white; /* NOT: Zoom butonu yazÄ± rengini buradan deÄŸiÅŸtirebilirsiniz */
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 50%;
            font-size: 1.5rem;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        /* Mobil DÃ¼zenlemeler */
        @media (max-width: 768px) {
            .modal-content {
                max-width: 90%;
                padding: 20px;
            }
            
            .room-name {
                font-size: 1.5rem;
            }
            
            .timer {
                font-size: 2rem;
            }
            
            .search-text {
                font-size: 1.2rem;
            }
            
            .clue {
                width: 120px;
                height: 120px;
            }
            
            .floor-btn {
                padding: 10px 20px;
                font-size: 1rem;
            }
            
            .clue-modal-content {
                max-width: 90%;
                padding: 20px;
            }
            
            .clue-title {
                font-size: 1.5rem;
            }
            
            .clue-description {
                font-size: 1rem;
            }
            
            .splash-title {
                font-size: 2rem;
            }
            
            .splash-description {
                font-size: 1rem;
            }
        }
        
        /* Animasyonlar */
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .pulse {
            animation: pulse 1.5s infinite;
        }
        
        /* Zoom Container */
        .zoom-container {
            position: relative;
            width: 100%;
            height: auto;
            transform-origin: center center;
        }
        
        /* Ä°pucu Bilgi Modal */
        .clue-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        
        .clue-modal-content {
            background-color: #222;
            max-width: 80%;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 0 25px rgba(255, 77, 77, 0.4);
            text-align: center;
        }
        
        .clue-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 15px;
        }
        
        .clue-description {
            font-size: 0.9rem;
            line-height: 1.4;
            text-align: justify;
        }
        
        .examine-btn {
            background-color: #ff4d4d;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .examine-btn:hover {
            background-color: #ff3333;
            transform: scale(1.05);
        }
        
        .disabled-room {
            opacity: 0.5 !important;
            cursor: not-allowed !important;
            pointer-events: all !important;
        }

        .custom-alert {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .alert-content {
            background-color: #333;
            border-radius: 10px;
            padding: 20px;
            max-width: 80%;
            text-align: center;
            box-shadow: 0 0 20px rgba(255, 77, 77, 0.4);
        }

        .alert-content h3 {
            margin-top: 0;
            color: #ff4d4d;
            margin-bottom: 15px;
        }

        .alert-content p {
            color: white;
            margin-bottom: 20px;
        }

        .alert-button {
            background-color: #ff4d4d;
            color: white;
            border: none;
            padding: 10px 30px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .alert-button:hover {
            background-color: #ff3333;
            transform: scale(1.05);
        }
    </style>
</head>
<body>
    <!-- ===== OYUN AÃ‡ILIÅ EKRANI =====
         NOT: Burada oyuna baÅŸlamadan Ã¶nce gÃ¶rÃ¼len aÃ§Ä±lÄ±ÅŸ ekranÄ± tanÄ±mlanmÄ±ÅŸtÄ±r.
         - Oyun baÅŸlÄ±ÄŸÄ± ve aÃ§Ä±klamasÄ±
         - Oyuncu adÄ± giriÅŸi
         - Oyun baÅŸlatma butonu -->
    <div class="splash-screen" id="splashScreen">
        <div class="splash-content">
            <h1 class="splash-title">Villa13 - Cinayet KeÅŸif Oyunu</h1> <!-- NOT: Ana baÅŸlÄ±ÄŸÄ± buradan deÄŸiÅŸtirebilirsiniz -->
            <p class="splash-description">
                Villa 13'teki esrarengiz cinayeti Ã§Ã¶zmek iÃ§in tÃ¼m odalarÄ± araÅŸtÄ±rmanÄ±z ve ipuÃ§larÄ±nÄ± bulmanÄ±z gerekiyor. 
                Her odayÄ± arama sÃ¼resi farklÄ±dÄ±r. Oyun ilerleyiÅŸiniz otomatik olarak kaydedilecektir.
            </p> <!-- NOT: AÃ§Ä±klama metnini buradan deÄŸiÅŸtirebilirsiniz -->
            <form class="player-form" id="playerForm">
                <input type="text" id="playerName" placeholder="Dedektif AdÄ±nÄ±z" required minlength="3"> <!-- NOT: Placeholder yazÄ±sÄ±nÄ± buradan deÄŸiÅŸtirebilirsiniz -->
                <button type="submit" class="start-game-btn">OYUNA BAÅLA</button> <!-- NOT: Buton yazÄ±sÄ±nÄ± buradan deÄŸiÅŸtirebilirsiniz -->
            </form>
        </div>
    </div>
    
    <!-- ===== OYUN ZAMANLAYICI VE OYUNCU BÄ°LGÄ°SÄ° =====
         NOT: Burada saÄŸ ve sol Ã¼st kÃ¶ÅŸede gÃ¶rÃ¼nen bilgi kutularÄ± tanÄ±mlanmÄ±ÅŸtÄ±r -->
    <div class="game-timer" id="gameTimer">SÃ¼re: <span id="totalGameTime">00:00:00</span></div> <!-- NOT: ZamanlayÄ±cÄ± baÅŸlÄ±ÄŸÄ±nÄ± buradan deÄŸiÅŸtirebilirsiniz -->
    <div class="player-info" id="playerInfo">Dedektif: <span id="playerNameDisplay">Bilinmiyor</span></div> <!-- NOT: Oyuncu bilgisi baÅŸlÄ±ÄŸÄ±nÄ± buradan deÄŸiÅŸtirebilirsiniz -->

    <!-- ===== ANA OYUN EKRANI =====
         NOT: Ana oyun ekranÄ±nÄ±n tamamÄ± burada tanÄ±mlanmÄ±ÅŸtÄ±r.
         - BaÅŸlÄ±k
         - Kat seÃ§im butonlarÄ±
         - Kat planÄ± gÃ¶rÃ¼ntÃ¼leri
         - Odalar
         - Zoom kontrolleri -->
    <div class="container" id="gameContainer" style="display: none;">
        <h1>Villa13 - Cinayet KeÅŸif Oyunu</h1> <!-- NOT: Oyun baÅŸlÄ±ÄŸÄ±nÄ± buradan deÄŸiÅŸtirebilirsiniz -->
        
        <!-- ===== KAT SEÃ‡Ä°M BUTONLARI ===== -->
        <div class="floor-nav">
            <button class="floor-btn active" data-floor="1">1. KAT</button> <!-- NOT: 1. kat buton yazÄ±sÄ±nÄ± buradan deÄŸiÅŸtirebilirsiniz -->
            <button class="floor-btn" data-floor="2">2. KAT</button> <!-- NOT: 2. kat buton yazÄ±sÄ±nÄ± buradan deÄŸiÅŸtirebilirsiniz -->
        </div>
        
        <!-- ===== KAT PLANLARI VE ODALAR ===== -->
        <div class="floor-view">
            <div class="zoom-container" id="zoomContainer">
            <!-- 1. Kat GÃ¶rÃ¼ntÃ¼sÃ¼ (VarsayÄ±lan) -->
            <img src="villa_1kat.jpg" alt="1. Kat" class="floor-image" id="floor1" style="display: block;"> <!-- NOT: 1. kat resmini buradan deÄŸiÅŸtirebilirsiniz -->
            <!-- 2. Kat GÃ¶rÃ¼ntÃ¼sÃ¼ (BaÅŸlangÄ±Ã§ta Gizli) -->
            <img src="villa_2kat.jpg" alt="2. Kat" class="floor-image" id="floor2" style="display: none;"> <!-- NOT: 2. kat resmini buradan deÄŸiÅŸtirebilirsiniz -->
            
            <!-- ===== 1. KAT ODALARI =====
                 NOT: Oda alanlarÄ±nÄ±n konumlarÄ± style iÃ§inde belirtilmiÅŸtir:
                 - top, left: OdanÄ±n konumunu belirtir (%)
                 - width, height: OdanÄ±n boyutunu belirtir (%)
                 - title: Fare imleci Ã¼zerine geldiÄŸinde gÃ¶sterilecek oda adÄ± -->
            <div class="room" data-room="mutfak" data-floor="1" style="top: 28%; left: 11%; width: 30%; height: 12%;" title="Mutfak"></div> <!-- NOT: Mutfak konumu ve baÅŸlÄ±ÄŸÄ± -->
            <div class="room" data-room="salon" data-floor="1" style="top: 41%; left: 15%; width: 37%; height: 16%;" title="Salon"></div> <!-- NOT: Salon konumu ve baÅŸlÄ±ÄŸÄ± -->
            <div class="room" data-room="calisma" data-floor="1" style="top: 45%; left: 52%; width: 15%; height: 12%;" title="Ã‡alÄ±ÅŸma OdasÄ±"></div> <!-- NOT: Ã‡alÄ±ÅŸma odasÄ± konumu ve baÅŸlÄ±ÄŸÄ± -->
            <div class="room" data-room="yemek" data-floor="1" style="top: 65%; left: 67%; width: 15%; height: 11%;" title="Yemek OdasÄ±"></div> <!-- NOT: Yemek odasÄ± konumu ve baÅŸlÄ±ÄŸÄ± -->
            <div class="room" data-room="nalan" data-floor="1" style="top: 31%; right: 18%; width: 17%; height: 13%;" title="Nalan'Ä±n OdasÄ±"></div> <!-- NOT: Nalan'Ä±n odasÄ± konumu ve baÅŸlÄ±ÄŸÄ± -->
            
            <!-- ===== 2. KAT ODALARI ===== -->
            <div class="room" data-room="elif" data-floor="2" style="top: 7%; left: 25%; width: 20%; height: 12%;" title="Elif'in OdasÄ±"></div> <!-- NOT: Elif'in odasÄ± konumu ve baÅŸlÄ±ÄŸÄ± -->
            <div class="room" data-room="asli" data-floor="2" style="top: 33%; left: 25%; width: 20%; height: 10%;" title="AslÄ±'nÄ±n OdasÄ±"></div> <!-- NOT: AslÄ±'nÄ±n odasÄ± konumu ve baÅŸlÄ±ÄŸÄ± -->
            <div class="room" data-room="sercan" data-floor="2" style="top: 24%; right: 15%; width: 18%; height: 14%;" title="Sercan'Ä±n OdasÄ±"></div> <!-- NOT: Sercan'Ä±n odasÄ± konumu ve baÅŸlÄ±ÄŸÄ± -->
            <div class="room" data-room="fikret" data-floor="2" style="bottom: 12%; left: 25%; width: 21%; height: 16%;" title="Fikret'in OdasÄ±"></div> <!-- NOT: Fikret'in odasÄ± konumu ve baÅŸlÄ±ÄŸÄ± -->
            </div>
            
            <!-- ===== ZOOM KONTROL BUTONLARI ===== -->
            <div class="zoom-controls">
                <button class="zoom-btn" id="zoomIn">+</button> <!-- NOT: YakÄ±nlaÅŸtÄ±rma butonu -->
                <button class="zoom-btn" id="zoomOut">-</button> <!-- NOT: UzaklaÅŸtÄ±rma butonu -->
                <button class="zoom-btn" id="zoomReset">âŸ²</button> <!-- NOT: SÄ±fÄ±rlama butonu -->
            </div>
        </div>
    </div>
    
    <!-- ===== ARAMA MODAL PENCERESÄ° =====
         NOT: Oda aramasÄ± iÃ§in aÃ§Ä±lan popup pencere burada tanÄ±mlanmÄ±ÅŸtÄ±r
         - Oda adÄ±
         - Arama baÅŸlatma bÃ¶lÃ¼mÃ¼
         - Arama ilerleme bÃ¶lÃ¼mÃ¼
         - Ä°puÃ§larÄ± listesi -->
    <div class="search-modal" id="searchModal">
        <div class="modal-content">
            <h2 class="room-name" id="currentRoom">Oda AdÄ±</h2> <!-- NOT: VarsayÄ±lan oda adÄ± (dinamik olarak deÄŸiÅŸir) -->
            <div id="searchConfirm">
                <p class="search-text">Bu odada detaylÄ± arama baÅŸlat...</p> <!-- NOT: Arama baÅŸlatma metni -->
                <p>SÃ¼re: <span id="searchTime">00</span> saniye</p> <!-- NOT: SÃ¼re metni -->
                <button class="start-search-btn" id="startSearchBtn">AramayÄ± BaÅŸlat</button> <!-- NOT: Arama baÅŸlatma butonu metni -->
            </div>
            <div id="searchProgress" style="display: none;">
            <p class="search-text">Oda aranÄ±yor...</p> <!-- NOT: Arama devam ederken gÃ¶sterilen metin -->
            <div class="timer" id="searchTimer">00</div>
            </div>
            
            <!-- Ä°pucu BÃ¶lÃ¼mÃ¼ (Arama tamamlandÄ±ÄŸÄ±nda gÃ¶sterilecek) -->
            <div class="clues-container" id="cluesContainer">
                <!-- Ä°puÃ§larÄ± dinamik olarak eklenir -->
            </div>
        </div>
    </div>
    
    <!-- ===== Ä°PUCU BÄ°LGÄ° MODAL PENCERESÄ° =====
         NOT: Ä°puÃ§larÄ±na tÄ±klandÄ±ÄŸÄ±nda gÃ¶sterilen detay penceresi -->
    <div class="clue-modal" id="clueModal">
        <div class="clue-modal-content">
            <h2 class="clue-title" id="clueTitle">Ä°pucu BaÅŸlÄ±ÄŸÄ±</h2> <!-- NOT: Ä°pucu baÅŸlÄ±ÄŸÄ± (dinamik olarak deÄŸiÅŸir) -->
            <p class="clue-description" id="clueDescription">Ä°pucu hakkÄ±nda detaylÄ± bilgi buraya gelecek...</p> <!-- NOT: Ä°pucu aÃ§Ä±klamasÄ± (dinamik olarak deÄŸiÅŸir) -->
            <button class="examine-btn" id="examineBtn">Ä°NCELE</button> <!-- NOT: Detay inceleme butonu metni -->
        </div>
    </div>
    
    <script>
        // ===== SES EFEKTLERÄ° SÄ°STEMÄ° =====
        // NOT: Oyunda kullanÄ±lan ses efektleri burada tanÄ±mlanmÄ±ÅŸtÄ±r
        // Ses dosyalarÄ±nÄ± "sounds" klasÃ¶rÃ¼ iÃ§ine yerleÅŸtirmeniz gerekir
        const soundEffects = {
            // ArayÃ¼z Sesleri
            click: new Audio('sounds/click.wav'),         // Genel tÄ±klama sesi
            modal: new Audio('sounds/modal.wav'),         // Modal aÃ§Ä±lma/kapanma sesi
            floorChange: new Audio('sounds/floor.wav'),   // Kat deÄŸiÅŸtirme sesi
            
            // Oyun AkÄ±ÅŸÄ± Sesleri
            searchStart: new Audio('sounds/search_start.wav'),    // Arama baÅŸlangÄ±cÄ± sesi
            searchComplete: new Audio('sounds/complete.wav'),     // Arama tamamlandÄ± sesi
            timer: new Audio('sounds/timer.wav'),                 // ZamanlayÄ±cÄ± uyarÄ± sesi
            
            // Oda EtkileÅŸim Sesleri
            roomHover: new Audio('sounds/room_hover.wav'),       // Oda Ã¼zerine gelme sesi
            roomDisabled: new Audio('sounds/disabled.wav'),      // Devre dÄ±ÅŸÄ± oda tÄ±klama sesi
            
            // Ä°pucu EtkileÅŸim Sesleri
            clueHover: new Audio('sounds/clue_hover.wav'),       // Ä°pucu Ã¼zerine gelme sesi
            clueClick: new Audio('sounds/clue_click.wav'),       // Ä°pucu tÄ±klama sesi
            clueExamine: new Audio('sounds/examine.wav'),        // Ä°nceleme butonu sesi
            
            // UyarÄ± ve Bildirim Sesleri
            alert: new Audio('sounds/alert.wav'),                // UyarÄ± sesi
            success: new Audio('sounds/success.wav')             // BaÅŸarÄ± sesi
        };

        // Ses Ã§alma fonksiyonu
        function playSound(soundName) {
            // Ses kapalÄ±ysa Ã§alma
            if (soundMuted) return;
            
            // Ses Ã§almayÄ± dene
            try {
                // Sesin varlÄ±ÄŸÄ±nÄ± kontrol et
                if (!soundEffects[soundName]) {
                    console.log("Ses bulunamadÄ±:", soundName);
                    return;
                }
                
                // Sesi durdur ve baÅŸtan Ã§al
                soundEffects[soundName].pause();
                soundEffects[soundName].currentTime = 0;
                soundEffects[soundName].volume = 0.4; // Ses seviyesi (0.0-1.0)
                soundEffects[soundName].play().catch(e => {
                    // KullanÄ±cÄ± etkileÅŸimi olmadan ses Ã§alÄ±namadÄ±ÄŸÄ±nda sessizce devam et
                    console.log("Ses Ã§alma hatasÄ± (etkileÅŸim gerekebilir):", e);
                });
            } catch (err) {
                console.log("Ses Ã§alma hatasÄ± (Ã¶nemsiz):", err);
            }
        }

        // Ses aÃ§ma/kapama kontrolÃ¼
        let soundMuted = false;

        function toggleSound() {
            soundMuted = !soundMuted;
            // Ses kontrolÃ¼ gÃ¶stergesini gÃ¼ncelle
            document.getElementById('soundToggle').textContent = soundMuted ? 'ğŸ”‡' : 'ğŸ”Š';
            // Ses durum mesajÄ±
            showTemporaryMessage(soundMuted ? "Sesler kapatÄ±ldÄ±" : "Sesler aÃ§Ä±ldÄ±");
        }

        // GeÃ§ici mesaj gÃ¶sterme fonksiyonu
        function showTemporaryMessage(message) {
            const messageDiv = document.createElement('div');
            messageDiv.className = 'temp-message';
            messageDiv.textContent = message;
            document.body.appendChild(messageDiv);
            
            // 2 saniye sonra kaldÄ±r
            setTimeout(() => {
                if (document.body.contains(messageDiv)) {
                    document.body.removeChild(messageDiv);
                }
            }, 2000);
        }

        // Oyun arayÃ¼zÃ¼ne ses aÃ§ma/kapama butonu ekleme
        function addSoundToggle() {
            // CSS stil ekle
            const style = document.createElement('style');
            style.textContent = `
                .sound-btn {
                    position: fixed;
                    top: 10px;
                    right: 120px;
                    background-color: rgba(0, 0, 0, 0.6);
                    color: white;
                    border: none;
                    border-radius: 50%;
                    width: 40px;
                    height: 40px;
                    font-size: 20px;
                    cursor: pointer;
                    z-index: 200;
                    display: flex;
                    justify-content: center;
                    align-items: center;
                    transition: all 0.3s ease;
                }
                .sound-btn:hover {
                    background-color: rgba(255, 77, 77, 0.8);
                    transform: scale(1.1);
                }
                .temp-message {
                    position: fixed;
                    top: 60px;
                    right: 120px;
                    background-color: rgba(0, 0, 0, 0.7);
                    color: white;
                    padding: 8px 12px;
                    border-radius: 4px;
                    z-index: 1000;
                    animation: fadeOut 2s forwards;
                }
                @keyframes fadeOut {
                    0% { opacity: 1; }
                    70% { opacity: 1; }
                    100% { opacity: 0; }
                }
            `;
            document.head.appendChild(style);
            
            // Ses butonunu ekle
            const soundBtn = document.createElement('button');
            soundBtn.id = 'soundToggle';
            soundBtn.className = 'sound-btn';
            soundBtn.textContent = 'ğŸ”Š';
            soundBtn.title = 'Sesi AÃ§/Kapat';
            soundBtn.onclick = toggleSound;
            document.body.appendChild(soundBtn);
        }
        
        // Mobil dokunma olaylarÄ±nÄ± geliÅŸtirmek iÃ§in yardÄ±mcÄ± fonksiyon
        function fixTouchEvents() {
            // iOS'ta 300ms tÄ±klama gecikmesini Ã¶nle
            document.addEventListener('touchstart', function(){}, {passive: false});
            
            // Ã‡ift dokunma yakÄ±nlaÅŸtÄ±rma sorunlarÄ±nÄ± Ã¶nle
            document.addEventListener('touchmove', function(e) {
                if (e.touches.length > 1) {
                    // Pinch-to-zoom iÃ§in bu olayÄ± engelleme
                    return;
                }
            }, {passive: false});
        }
        
        // Service Worker KaydÄ± - gÃ¼venli ÅŸekilde
        function initServiceWorker() {
            try {
                const hasServiceWorker = 'serviceWorker' in navigator;
                const hasPushManager = 'PushManager' in window;
                const hasNotification = typeof Notification !== 'undefined';
                
                if (hasServiceWorker && hasPushManager) {
                    window.addEventListener('load', function() {
                        navigator.serviceWorker.register('sw.js').then(function(registration) {
                            console.log('ServiceWorker kaydÄ± baÅŸarÄ±lÄ±: ', registration.scope);
                            
                            // Bildirim izni iste (gÃ¼venli)
                            if (hasNotification) {
                                Notification.requestPermission().then(function(permission) {
                                    if (permission === 'granted') {
                                        console.log('Bildirim izni verildi');
                                    }
                                }).catch(function(err) {
                                    console.log('Bildirim izni hatasÄ± (Ã¶nemsiz):', err);
                                });
                            }
                        }, function(err) {
                            console.log('ServiceWorker kaydÄ± baÅŸarÄ±sÄ±z: ', err);
                        });
                    });
                } else {
                    console.log('Service Worker veya Push API desteklenmiyor. Ã–nemli deÄŸil, uygulama Ã§alÄ±ÅŸmaya devam edecek.');
                }
            } catch (err) {
                console.log('Service Worker baÅŸlatma hatasÄ± (Ã¶nemsiz):', err);
                // Sessizce devam et, kullanÄ±cÄ±ya gÃ¶sterme
            }
        }
        
        // Service Worker'Ä± baÅŸlat
        initServiceWorker();
        
        // Ekran UyanÄ±k Tutma API'si
        let wakeLock = null;
        
        async function requestWakeLock() {
            try {
                if ('wakeLock' in navigator) {
                    wakeLock = await navigator.wakeLock.request('screen');
                    wakeLock.addEventListener('release', () => {
                        console.log('Ekran kilidi serbest bÄ±rakÄ±ldÄ±');
                    });
                    console.log('Ekran kilidi aktif');
                }
            } catch (err) {
                console.error(`Ekran kilidi hatasÄ±: ${err.name}, ${err.message}`);
            }
        }
        
        // LocalStorage AnahtarlarÄ±
        const PLAYER_KEY = 'villa13_player';
        const STORAGE_KEY = 'villa13_game_state';
        const GAME_START_KEY = 'villa13_game_start';
        
        // Oyun baÅŸlangÄ±Ã§ saati
        let gameStartTime = null;
        let gameTimer = null;
        
        // GiriÅŸ formu iÅŸleme
        document.getElementById('playerForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const playerName = document.getElementById('playerName').value.trim();
            if (playerName.length < 3) {
                alert('LÃ¼tfen en az 3 karakter uzunluÄŸunda bir isim girin.');
                return;
            }
            
            // Oyuncu adÄ±nÄ± kaydet
            localStorage.setItem(PLAYER_KEY, playerName);
            
            // Oyun baÅŸlangÄ±Ã§ zamanÄ±nÄ± kaydet
            if (!localStorage.getItem(GAME_START_KEY)) {
                const now = new Date().getTime();
                localStorage.setItem(GAME_START_KEY, now);
                gameStartTime = now;
            } else {
                gameStartTime = parseInt(localStorage.getItem(GAME_START_KEY));
            }
            
            // Oyuncu adÄ±nÄ± gÃ¶ster
            document.getElementById('playerNameDisplay').textContent = playerName;
            
            // EkranÄ± uyanÄ±k tutmayÄ± dene (gÃ¼venli ÅŸekilde)
            try {
                requestWakeLock();
            } catch (err) {
                console.log("WakeLock hatasÄ± (Ã¶nemsiz):", err);
            }
            
            // Oyun sayacÄ±nÄ± baÅŸlat
            startGameTimer();
            
            // GiriÅŸ ekranÄ±nÄ± gizle, oyun ekranÄ±nÄ± gÃ¶ster
            document.getElementById('splashScreen').style.display = 'none';
            document.getElementById('gameContainer').style.display = 'block';
            
            // HoÅŸ geldin sesi Ã§al
            playSound('success');
            
            // Oyun durumunu yÃ¼kle
            loadGameState();
            
            // Kesintiye uÄŸramÄ±ÅŸ aramalarÄ± kontrol et
            checkPendingSearches();
        });
        
        // Sayfa yÃ¼klendiÄŸinde oyuncu kontrolÃ¼
        window.addEventListener('load', function() {
            // Mobil dokunma olaylarÄ±nÄ± dÃ¼zelt
            fixTouchEvents();
            
            // Ses kontrol butonu ekle
            addSoundToggle();
            
            const savedPlayer = localStorage.getItem(PLAYER_KEY);
            const savedGameStart = localStorage.getItem(GAME_START_KEY);
            
            // EÄŸer daha Ã¶nce oyuna baÅŸlamÄ±ÅŸsa
            if (savedPlayer && savedGameStart) {
                document.getElementById('playerName').value = savedPlayer;
                document.getElementById('playerNameDisplay').textContent = savedPlayer;
                gameStartTime = parseInt(savedGameStart);
                
                // Otomatik olarak oyunu baÅŸlat
                document.getElementById('splashScreen').style.display = 'none';
                document.getElementById('gameContainer').style.display = 'block';
                
                // EkranÄ± uyanÄ±k tutmayÄ± dene (gÃ¼venli)
                try {
                    requestWakeLock();
                } catch (err) {
                    console.log("WakeLock hatasÄ± (Ã¶nemsiz):", err);
                }
                
                // Oyun sayacÄ±nÄ± baÅŸlat
                startGameTimer();
                
                // Oyun durumunu yÃ¼kle
                loadGameState();
                
                // OdalarÄ±n durumlarÄ±nÄ± gÃ¼ncelle
                updateRoomStates();
                
                // Kesintiye uÄŸramÄ±ÅŸ aramalarÄ± kontrol et
                checkPendingSearches();
            }
            
            // Sayfa gÃ¶rÃ¼nÃ¼rlÃ¼k deÄŸiÅŸikliÄŸini izle (sekme/uygulama deÄŸiÅŸtirme, vb.)
            document.addEventListener('visibilitychange', function() {
                if (document.visibilityState === 'visible') {
                    // EkranÄ± tekrar kilitle (gÃ¼venli)
                    try {
                        requestWakeLock();
                    } catch (err) {
                        console.log("WakeLock hatasÄ± (Ã¶nemsiz):", err);
                    }
                    
                    // AramalarÄ± kontrol et
                    checkPendingSearches();
                    
                    // OdalarÄ±n durumlarÄ±nÄ± gÃ¼ncelle
                    updateRoomStates();
                    
                    // Oyun sÃ¼resini gÃ¼ncelle
                    updateGameTime();
                }
            });
        });
        
        // Oyun SayacÄ±
        function startGameTimer() {
            updateGameTime();
            gameTimer = setInterval(updateGameTime, 1000);
        }
        
        function updateGameTime() {
            if (!gameStartTime) return;
            
            const now = new Date().getTime();
            const elapsedTime = now - gameStartTime;
            
            const hours = Math.floor(elapsedTime / (1000 * 60 * 60));
            const minutes = Math.floor((elapsedTime % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((elapsedTime % (1000 * 60)) / 1000);
            
            const timeString = `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
            document.getElementById('totalGameTime').textContent = timeString;
        }
        
        // Oyun deÄŸiÅŸkenleri
        const floors = {
            1: document.getElementById('floor1'),
            2: document.getElementById('floor2')
        };
        const floorButtons = document.querySelectorAll('.floor-btn');
        const rooms = document.querySelectorAll('.room');
        const searchModal = document.getElementById('searchModal');
        const currentRoomElement = document.getElementById('currentRoom');
        const searchTimer = document.getElementById('searchTimer');
        const cluesContainer = document.getElementById('cluesContainer');
        
        // Zoom deÄŸiÅŸkenleri
        const zoomInBtn = document.getElementById('zoomIn');
        const zoomOutBtn = document.getElementById('zoomOut');
        const zoomResetBtn = document.getElementById('zoomReset');
        const floorView = document.querySelector('.floor-view');
        const zoomContainer = document.getElementById('zoomContainer');
        let currentScale = 1;
        let currentTranslateX = 0;
        let currentTranslateY = 0;
        let isDragging = false;
        let startX, startY, initialTranslateX, initialTranslateY;
        
        // GeÃ§erli kat
        let currentFloor = 1;
        
        // ===== ARAMA SÃœRELERÄ° =====
        // NOT: Oda arama sÃ¼relerini buradan deÄŸiÅŸtirebilirsiniz (saniye cinsinden)
        // 120 saniye = 2 dakika
        let searchInterval;
        const roomSearchTimes = {
            'salon': 120, // NOT: Salon aramasÄ± sÃ¼resi - 2 dakika
            'mutfak': 120, // NOT: Mutfak aramasÄ± sÃ¼resi - 2 dakika
            'calisma': 120, // NOT: Ã‡alÄ±ÅŸma odasÄ± aramasÄ± sÃ¼resi - 2 dakika
            'yemek': 120, // NOT: Yemek odasÄ± aramasÄ± sÃ¼resi - 2 dakika
            'nalan': 120, // NOT: Nalan'Ä±n odasÄ± aramasÄ± sÃ¼resi - 2 dakika
            'elif': 120, // NOT: Elif'in odasÄ± aramasÄ± sÃ¼resi - 2 dakika
            'asli': 120, // NOT: AslÄ±'nÄ±n odasÄ± aramasÄ± sÃ¼resi - 2 dakika
            'sercan': 120, // NOT: Sercan'Ä±n odasÄ± aramasÄ± sÃ¼resi - 2 dakika
            'fikret': 120 // NOT: Fikret'in odasÄ± aramasÄ± sÃ¼resi - 2 dakika
        };
        
        // ===== TEST MODU =====
        // NOT: Localhost'ta test ederken sÃ¼relerin daha kÄ±sa olmasÄ± iÃ§in
        // GerÃ§ek oyun iÃ§in bu kÄ±smÄ± silebilirsiniz
        if (location.hostname === 'localhost' || location.hostname === '127.0.0.1') {
            for (let room in roomSearchTimes) {
                roomSearchTimes[room] = Math.ceil(roomSearchTimes[room] / 60); // Saniye cinsinden test sÃ¼releri
            }
        }
        
        // ===== OYUN DURUMU =====
        // NOT: Oyunun durumunu tutan deÄŸiÅŸken
        // Bu deÄŸiÅŸken localStorage'da saklanÄ±r ve oyun yeniden yÃ¼klendiÄŸinde kaldÄ±ÄŸÄ± yerden devam eder
        let gameState = {
            searchedRooms: {}, // Arama baÅŸlatÄ±lan odalarÄ±n listesi
            completedSearches: [], // Tamamlanan odalarÄ±n listesi
            activeSearch: null // Aktif olarak aranan oda kimliÄŸi
        };
        
        // ===== OYUN DURUMUNU YÃœKLEME =====
        // NOT: LocalStorage'dan oyun durumunu yÃ¼kleyen fonksiyon
        function loadGameState() {
            const savedState = localStorage.getItem(STORAGE_KEY);
            if (savedState) {
                try {
                    gameState = JSON.parse(savedState);
                    // Eski versiyon uyumluluÄŸu
                    if (!gameState.hasOwnProperty('activeSearch')) {
                        gameState.activeSearch = null;
                    }
                    console.log('Oyun durumu yÃ¼klendi:', gameState);
                    return gameState;
                } catch (e) {
                    console.error('Oyun durumu yÃ¼klenirken hata:', e);
                    return {
                        searchedRooms: {},
                        completedSearches: [],
                        activeSearch: null
                    };
                }
            }
            return {
                searchedRooms: {},
                completedSearches: [],
                activeSearch: null
            };
        }
        
        // ===== OYUN DURUMUNU KAYDETME =====
        // NOT: Oyun durumunu LocalStorage'a kaydeden fonksiyon
        function saveGameState(state) {
            try {
                localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
                console.log('Oyun durumu kaydedildi:', state);
            } catch (e) {
                console.error('Oyun durumu kaydedilirken hata:', e);
            }
        }
        
        // AramalarÄ± kontrol et ve devam ettir
        function checkPendingSearches() {
            try {
                console.log("Devam eden aramalarÄ± kontrol ediliyor...");
                const currentTime = new Date().getTime();
                let pendingSearchFound = false;
                
                // EÄŸer aktif arama varsa, bu odayÄ± kontrol et
                if (gameState.activeSearch && gameState.searchedRooms[gameState.activeSearch]) {
                    const roomId = gameState.activeSearch;
                    // EÄŸer oda zaten tamamlanmÄ±ÅŸsa, aktif aramayÄ± temizle
                    if (gameState.completedSearches.includes(roomId)) {
                        gameState.activeSearch = null;
                        saveGameState(gameState);
                        return false;
                    }
                    
                    const roomData = gameState.searchedRooms[roomId];
                    const endTime = roomData.startTime + (roomSearchTimes[roomId] * 1000);
                    
                    console.log(`Aktif oda ${roomId} kontrolÃ¼: BitiÅŸ zamanÄ±: ${new Date(endTime).toLocaleTimeString()}, Åimdi: ${new Date(currentTime).toLocaleTimeString()}`);
                    
                    // Arama henÃ¼z tamamlanmamÄ±ÅŸ
                    if (currentTime < endTime) {
                        const remainingTime = Math.ceil((endTime - currentTime) / 1000);
                        console.log(`Devam eden aktif arama bulundu: Oda ${roomId}, Kalan sÃ¼re: ${remainingTime} saniye`);
                        
                        const roomElement = document.querySelector(`.room[data-room="${roomId}"]`);
                        const roomFloor = roomElement ? roomElement.dataset.floor : '1';
                        
                        // Ä°lgili katÄ± gÃ¶ster
                        switchFloor(roomFloor);
                        
                        // Arama modalÄ±nÄ± gÃ¶ster
                        const roomName = roomElement ? roomElement.title : roomId;
                        currentRoomElement.textContent = roomName;
                        document.getElementById('searchConfirm').style.display = 'none';
                        document.getElementById('searchProgress').style.display = 'block';
                        document.getElementById('searchProgress').querySelector('.search-text').textContent = 'Oda aranÄ±yor...';
                        searchModal.style.display = 'flex';
                        
                        // AramayÄ± devam ettir
                        startSearch(roomId, remainingTime);
                        return true;
                    } else {
                        // SÃ¼re dolmuÅŸ, tamamlananlara ekle ve aktif aramayÄ± temizle
                        console.log(`Oda ${roomId} aramasÄ± tamamlandÄ±, listeye ekleniyor`);
                        gameState.completedSearches.push(roomId);
                        gameState.activeSearch = null;
                        saveGameState(gameState);
                    }
                } else {
                    // Aktif arama yoksa, temizlik yap
                    // DiÄŸer odalarÄ± da kontrol et ve tamamlananlarÄ± listeye ekle
                    for (const roomId in gameState.searchedRooms) {
                        if (gameState.completedSearches.includes(roomId)) {
                            continue;
                        }
                        
                        const roomData = gameState.searchedRooms[roomId];
                        const endTime = roomData.startTime + (roomSearchTimes[roomId] * 1000);
                        
                        if (currentTime >= endTime) {
                            console.log(`Eski oda ${roomId} aramasÄ± tamamlandÄ±, listeye ekleniyor`);
                            gameState.completedSearches.push(roomId);
                            saveGameState(gameState);
                        }
                    }
                }
                
                return pendingSearchFound;
            } catch (err) {
                console.error("checkPendingSearches hatasÄ±:", err);
                return false;
            }
        }
        
        // Kat deÄŸiÅŸtirme fonksiyonu
        function switchFloor(floorNum) {
            currentFloor = parseInt(floorNum);
            
            // GÃ¶rsel deÄŸiÅŸtirme
            for (let floor in floors) {
                floors[floor].style.display = floor == currentFloor ? 'block' : 'none';
            }
            
            // Buton aktifliÄŸini gÃ¼ncelle
            floorButtons.forEach(btn => {
                if (btn.dataset.floor == currentFloor) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // OdalarÄ± gÃ¼ncelle (sadece aktif katÄ±n odalarÄ± gÃ¶sterilsin)
            rooms.forEach(room => {
                if (room.dataset.floor == currentFloor) {
                    room.style.display = 'block';
                } else {
                    room.style.display = 'none';
                }
            });
            
            // Zoom'u sÄ±fÄ±rla
            resetZoom();
        }
        
        // Arama fonksiyonu (Ã–n HazÄ±rlÄ±k)
        function prepareSearch(roomId) {
            try {
                console.log("Arama hazÄ±rlanÄ±yor: " + roomId);
                const roomElement = document.querySelector(`.room[data-room="${roomId}"]`);
                if (!roomElement) {
                    console.error("Oda elementi bulunamadÄ±:", roomId);
                    return;
                }
                
                const roomName = roomElement.title;
                const searchTime = roomSearchTimes[roomId] || 30;
                
                // EÄŸer oda tamamlandÄ±ysa doÄŸrudan ipuÃ§larÄ±nÄ± gÃ¶ster
                if (gameState.completedSearches.includes(roomId)) {
                    console.log("Oda zaten tamamlanmÄ±ÅŸ, ipuÃ§larÄ± gÃ¶steriliyor");
                    currentRoomElement.textContent = roomName;
                    document.getElementById('searchConfirm').style.display = 'none';
                    document.getElementById('searchProgress').style.display = 'none';
                    document.getElementById('searchProgress').querySelector('.search-text').textContent = 'Arama tamamlandÄ±! Bulunan ipuÃ§larÄ±:';
                    createClues(roomId);
                    cluesContainer.style.display = 'flex';
                    searchModal.style.display = 'flex';
                    return;
                }
                
                // EÄŸer aktif bir arama varsa ve bu odanÄ±n aramasÄ± deÄŸilse, uyarÄ± ver
                if (gameState.activeSearch && gameState.activeSearch !== roomId) {
                    const activeRoomElement = document.querySelector(`.room[data-room="${gameState.activeSearch}"]`);
                    const activeRoomName = activeRoomElement ? activeRoomElement.title : gameState.activeSearch;
                    
                    // Standart uyarÄ± yerine Ã¶zelleÅŸtirilmiÅŸ uyarÄ± kullan
                    showCustomAlert(`Åu anda "${activeRoomName}" odasÄ±nda arama devam ediyor. AynÄ± anda sadece bir odada arama yapabilirsiniz.`);
                    return;
                }
                
                // EÄŸer bu odanÄ±n aramasÄ± zaten baÅŸlatÄ±lmÄ±ÅŸsa ve devam ediyorsa
                const currentTime = new Date().getTime();
                const roomData = gameState.searchedRooms[roomId];
                
                if (roomData && gameState.activeSearch === roomId) {
                    const endTime = roomData.startTime + (roomSearchTimes[roomId] * 1000);
                    const remainingTime = Math.ceil((endTime - currentTime) / 1000);
                    
                    if (remainingTime > 0) {
                        console.log("Devam eden arama bulundu, kalan sÃ¼re: " + remainingTime);
                        // Modal iÃ§eriklerini gÃ¼ncelle
                        currentRoomElement.textContent = roomName;
                        document.getElementById('searchConfirm').style.display = 'none';
                        document.getElementById('searchProgress').style.display = 'block';
                        document.getElementById('searchProgress').querySelector('.search-text').textContent = 'Oda aranÄ±yor...';
                        
                        // ModalÄ± gÃ¶ster ve aramayÄ± devam ettir
                        searchModal.style.display = 'flex';
                        startSearch(roomId, remainingTime);
                        return;
                    } else {
                        // SÃ¼re dolmuÅŸ, tamamlananlara ekle ve aktif aramayÄ± temizle
                        gameState.completedSearches.push(roomId);
                        gameState.activeSearch = null;
                        saveGameState(gameState);
                        
                        // Ä°puÃ§larÄ±nÄ± gÃ¶ster
                        currentRoomElement.textContent = roomName;
                        document.getElementById('searchConfirm').style.display = 'none';
                        document.getElementById('searchProgress').style.display = 'none';
                        document.getElementById('searchProgress').querySelector('.search-text').textContent = 'Arama tamamlandÄ±! Bulunan ipuÃ§larÄ±:';
                        createClues(roomId);
                        cluesContainer.style.display = 'flex';
                        searchModal.style.display = 'flex';
                        return;
                    }
                }
                
                // Normal baÅŸlangÄ±Ã§ durumu - Yeni arama
                currentRoomElement.textContent = roomName;
                currentRoomElement.dataset.roomid = roomId; // Oda ID'sini element'e ekle
                
                // Saniye formatÄ±nÄ± dakika:saniye formatÄ±na Ã§evir
                const minutes = Math.floor(searchTime / 60);
                const seconds = searchTime % 60;
                const timeString = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                document.getElementById('searchTime').textContent = timeString;
                
                // Ä°puÃ§larÄ± bÃ¶lÃ¼mÃ¼nÃ¼ gizle
                cluesContainer.style.display = 'none';
                
                // Arama onay ekranÄ±nÄ± gÃ¶ster, ilerleme ekranÄ±nÄ± gizle
                document.getElementById('searchConfirm').style.display = 'block';
                document.getElementById('searchProgress').style.display = 'none';
                
                // ModalÄ± gÃ¶ster
                searchModal.style.display = 'flex';
                
                // AramayÄ± baÅŸlat butonuna tÄ±klama olayÄ±nÄ± temizle ve yeniden ekle
                const startButton = document.getElementById('startSearchBtn');
                
                // TÃ¼m olay dinleyicilerini kaldÄ±r ve yeniden ekle
                const newButton = startButton.cloneNode(true);
                startButton.parentNode.replaceChild(newButton, startButton);
                
                // Yeni tÄ±klama olayÄ±nÄ± ekle
                newButton.addEventListener('click', function(e) {
                    e.preventDefault();
                    startSearch(roomId);
                });
                
                // Mobil iÃ§in touch olayÄ± ekle
                newButton.addEventListener('touchend', function(e) {
                    e.preventDefault();
                    e.stopPropagation();
                    startSearch(roomId);
                }, { passive: false });
            } catch (err) {
                console.error("prepareSearch hatasÄ±:", err);
                showCustomAlert("Arama hazÄ±rlanÄ±rken bir hata oluÅŸtu: " + err.message);
            }
        }
        
        // Ã–zelleÅŸtirilmiÅŸ uyarÄ± gÃ¶sterme fonksiyonu
        function showCustomAlert(message) {
            // Mevcut alertleri temizle
            const existingAlerts = document.querySelectorAll('.custom-alert');
            existingAlerts.forEach(alert => {
                document.body.removeChild(alert);
            });

            // Modal dÄ±ÅŸÄ±nda alert gÃ¶ster
            searchModal.style.display = 'none';

            // UyarÄ± elementi oluÅŸtur
            const alertDiv = document.createElement('div');
            alertDiv.className = 'custom-alert';
            alertDiv.innerHTML = `
                <div class="alert-content">
                    <h3>Bu sayfanÄ±n mesajÄ±</h3>
                    <p>${message}</p>
                    <button id="alertOkButton" class="alert-button">Tamam</button>
                </div>
            `;

            // UyarÄ± sesi Ã§al
            playSound('alert');
            
            // Body'e ekle
            document.body.appendChild(alertDiv);

            // Tamam butonuna tÄ±klama olayÄ± ekle
            document.getElementById('alertOkButton').addEventListener('click', function() {
                document.body.removeChild(alertDiv);
                // TÄ±klama sesi Ã§al
                playSound('click');
                // Oda durumlarÄ±nÄ± gÃ¼ncelle
                updateRoomStates();
            });

            // 5 saniye sonra otomatik kapat
            setTimeout(() => {
                if (document.body.contains(alertDiv)) {
                    document.body.removeChild(alertDiv);
                    // Oda durumlarÄ±nÄ± gÃ¼ncelle
                    updateRoomStates();
                }
            }, 5000);
        }
        
        // Arama fonksiyonu (BaÅŸlatma)
        function startSearch(roomId, remainingTime = null) {
            try {
                console.log("Oda aramasÄ± baÅŸlatÄ±lÄ±yor: " + roomId);
                
                // Arama baÅŸlangÄ±Ã§ sesi Ã§al
                playSound('searchStart');
                
                // Arama onay ekranÄ±nÄ± gizle, ilerleme ekranÄ±nÄ± gÃ¶ster
                document.getElementById('searchConfirm').style.display = 'none';
                document.getElementById('searchProgress').style.display = 'block';
            
                // Ã–nceki timer'Ä± temizle
                if (searchInterval) {
                    clearInterval(searchInterval);
                    searchInterval = null;
                }
            
                // EÄŸer daha Ã¶nce aramaya baÅŸlanmÄ±ÅŸsa kalan sÃ¼reyi kullan
                let timeLeft = remainingTime || roomSearchTimes[roomId];
                console.log("BaÅŸlangÄ±Ã§ sÃ¼resi: " + timeLeft);
            
                // EÄŸer bu ilk arama ise, arama baÅŸlangÄ±Ã§ zamanÄ±nÄ± kaydet
                if (!remainingTime && !gameState.searchedRooms[roomId]) {
                    gameState.searchedRooms[roomId] = {
                        startTime: new Date().getTime()
                    };
                    // Aktif aramayÄ± bu oda olarak ayarla
                    gameState.activeSearch = roomId;
                    saveGameState(gameState);
                } else if (!gameState.activeSearch) {
                    // EÄŸer aktif arama yoksa, bu odayÄ± aktif arama olarak ayarla
                    gameState.activeSearch = roomId;
                    saveGameState(gameState);
                }
            
                // Ä°lk gÃ¶rÃ¼ntÃ¼leme
                updateSearchTimerDisplay(timeLeft);
                document.getElementById('searchTimer').classList.add('pulse');
                
                // Son bitiÅŸ zamanÄ±nÄ± hesapla
                const endTime = new Date().getTime() + (timeLeft * 1000);
                
                // Timer baÅŸlat - setInterval yerine setTimeout ve recursive
                function tick() {
                    // Kalan sÃ¼reyi hesapla
                    const now = new Date().getTime();
                    const remaining = Math.ceil((endTime - now) / 1000);
                    
                    if (remaining <= 0) {
                        // SÃ¼re doldu, aramayÄ± tamamla
                        console.log("SÃ¼re doldu, arama tamamlandÄ±");
                        updateSearchTimerDisplay(0);
                        // Oda tamamlandÄ± ve aktif arama temizlendi
                        gameState.activeSearch = null;
                        searchCompleted(roomId);
                        return;
                    }
                    
                    // SÃ¼reyi gÃ¼ncelle
                    console.log("Kalan sÃ¼re: " + remaining);
                    updateSearchTimerDisplay(remaining);
                    
                    // Son 10 saniyede timer sesi Ã§al
                    if (remaining <= 10) {
                        playSound('timer');
                    }
                    
                    // Sonraki tick'i zamanla
                    setTimeout(tick, 1000);
                }
                
                // Ä°lk tick'i baÅŸlat
                searchInterval = setTimeout(tick, 1000);
                
                // DiÄŸer odalarÄ±n butonlarÄ±nÄ± devre dÄ±ÅŸÄ± bÄ±rak ve gÃ¶rÃ¼nÃ¼mlerini gÃ¼ncelle
                updateRoomStates();
                
                // Bildirim gÃ¶nder (mobil iÃ§in) - GÃ¼venli kontrol ile
                try {
                    const hasNotificationAPI = typeof Notification !== 'undefined';
                    const roomName = document.querySelector(`.room[data-room="${roomId}"]`).title;
                    
                    if (hasNotificationAPI && 'serviceWorker' in navigator) {
                        // Bildirim izni kontrolÃ¼
                        if (Notification.permission === 'granted') {
                            // Arama baÅŸlangÄ±Ã§ bildirimi
                            setTimeout(() => {
                                try {
                                    navigator.serviceWorker.ready.then(function(registration) {
                                        registration.showNotification('Villa13 - Arama BaÅŸladÄ±', {
                                            body: `${roomName} aramasÄ± baÅŸladÄ±.`,
                                            icon: 'https://placehold.co/192x192/333/white?text=V13',
                                            vibrate: [200, 100, 200]
                                        });
                                    });
                                } catch (err) {
                                    console.log("Bildirim gÃ¶nderme hatasÄ± (Ã¶nemsiz):", err);
                                }
                            }, 1000);
                            
                            // Arama bitince bildirim
                            setTimeout(() => {
                                try {
                                    navigator.serviceWorker.ready.then(function(registration) {
                                        registration.showNotification('Villa13 - Arama TamamlandÄ±', {
                                            body: `${roomName} aramasÄ± tamamlandÄ±! Ä°puÃ§larÄ±nÄ± inceleyebilirsiniz.`,
                                            icon: 'https://placehold.co/192x192/333/white?text=V13',
                                            vibrate: [200, 100, 200, 100, 200]
                                        });
                                    });
                                } catch (err) {
                                    console.log("Bildirim gÃ¶nderme hatasÄ± (Ã¶nemsiz):", err);
                                }
                            }, timeLeft * 1000);
                        }
                    }
                } catch (err) {
                    // Notification API hatalarÄ±nÄ± sessizce yoksay - kullanÄ±cÄ±ya gÃ¶sterme
                    console.log("Notification API desteklenmiyor veya eriÅŸilemedi (Ã¶nemsiz):", err);
                }
            } catch (err) {
                console.error("startSearch hatasÄ±:", err);
                alert("Arama baÅŸlatÄ±lÄ±rken bir hata oluÅŸtu: " + err.message);
                playSound('alert');
            }
        }
        
        // Timer ekranÄ±nÄ± dakika:saniye formatÄ±nda gÃ¼ncelle
        function updateSearchTimerDisplay(timeInSeconds) {
            try {
                console.log("Timer gÃ¼ncelleniyor: " + timeInSeconds);
                const minutes = Math.floor(timeInSeconds / 60);
                const seconds = timeInSeconds % 60;
                const timeString = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                const timerElement = document.getElementById('searchTimer');
                if (timerElement) {
                    timerElement.textContent = timeString;
                } else {
                    console.error("Timer elementi bulunamadÄ±!");
                }
            } catch (err) {
                console.error("Timer gÃ¼ncelleme hatasÄ±:", err);
            }
        }
        
        // Arama tamamlandÄ±ÄŸÄ±nda Ã§aÄŸrÄ±lacak fonksiyon
        function searchCompleted(roomId) {
            try {
                console.log("Arama tamamlandÄ±: " + roomId);
                
                // Arama tamamlandÄ± sesi Ã§al
                playSound('searchComplete');
                
                // Ä°lerleme ekranÄ±nÄ± gizle
                document.getElementById('searchProgress').style.display = 'none';
                document.getElementById('searchTimer').classList.remove('pulse');
            
                // Tamamlanan odayÄ± kaydet
                if (!gameState.completedSearches.includes(roomId)) {
                    gameState.completedSearches.push(roomId);
                }
                
                // Aktif aramayÄ± temizle
                gameState.activeSearch = null;
                saveGameState(gameState);
                
                // OdalarÄ±n durumlarÄ±nÄ± gÃ¼ncelle
                updateRoomStates();
            
                // Ä°puÃ§larÄ±nÄ± gÃ¶sterme mesajÄ±nÄ± gÃ¼ncelle
                document.getElementById('searchProgress').querySelector('.search-text').textContent = 'Arama tamamlandÄ±! Bulunan ipuÃ§larÄ±:';
                
                // Oda adÄ±nÄ± gÃ¶stermeye devam et
                const roomElement = document.querySelector(`.room[data-room="${roomId}"]`);
                if (roomElement) {
                    currentRoomElement.textContent = roomElement.title;
                    currentRoomElement.dataset.roomid = roomId;
                }
            
                // Ä°puÃ§larÄ±nÄ± oluÅŸtur
                createClues(roomId);
            
                // Ä°puÃ§larÄ± bÃ¶lÃ¼mÃ¼nÃ¼ gÃ¶ster
                cluesContainer.style.display = 'flex';
                
                // Timer'Ä± temizle
                if (searchInterval) {
                    clearTimeout(searchInterval);
                    searchInterval = null;
                }
            } catch (err) {
                console.error("searchCompleted hatasÄ±:", err);
                showCustomAlert("Arama tamamlanÄ±rken bir hata oluÅŸtu: " + err.message);
            }
        }
        
        // Ä°puÃ§larÄ±nÄ± oluÅŸturma fonksiyonu
        function createClues(roomId) {
            try {
                console.log("Ä°puÃ§larÄ± oluÅŸturuluyor: " + roomId);
                
                // Ã–nce mevcut ipuÃ§larÄ±nÄ± temizle
                cluesContainer.innerHTML = '';
            
                // Ä°lgili odanÄ±n ipuÃ§larÄ±nÄ± oluÅŸtur
                const clues = roomClues[roomId] || [];
            
                // Konsolda kanÄ±t bilgilerini logla - debug iÃ§in
                console.log("Oda ID:", roomId);
                console.log("Bu odaya ait kanÄ±tlar:", clues);
                
                // EÄŸer kanÄ±t yoksa
                if (clues.length === 0) {
                    const noClue = document.createElement('p');
                    noClue.textContent = 'Bu odada ilgili bir ipucu bulunamadÄ±.';
                    cluesContainer.appendChild(noClue);
                    return;
                }
                
                // KanÄ±tlarÄ± oluÅŸtur
                clues.forEach(clue => {
                    const clueElement = document.createElement('div');
                    clueElement.className = 'clue';
                    
                    // GÃ¶rsel ve baÅŸlÄ±k iÃ§eriÄŸi
                    clueElement.innerHTML = `
                        <img src="${clue.image}" alt="${clue.name}" onerror="this.onerror=null; this.src='kanit_default.jpg';">
                        <div class="clue-name">${clue.name}</div>
                    `;
                
                    // Oda ID'sini veri Ã¶zelliÄŸi olarak ekle
                    clueElement.dataset.roomId = roomId;
                    
                    // Hover sesi iÃ§in olay dinleyici ekle
                    clueElement.addEventListener('mouseenter', function() {
                        playSound('clueHover');
                    });
                    
                    // Ä°pucu tÄ±klandÄ±ÄŸÄ±nda bilgi modalini gÃ¶ster
                    clueElement.addEventListener('click', () => {
                        playSound('clueClick');
                        showClueInfo(clue, roomId);
                    });
                
                    cluesContainer.appendChild(clueElement);
                });
            
            } catch (err) {
                console.error("createClues hatasÄ±:", err);
                // Hata durumunda basit bir mesaj gÃ¶ster
                cluesContainer.innerHTML = '<p>Ä°puÃ§larÄ± yÃ¼klenirken bir sorun oluÅŸtu.</p>';
            }
        }
        
        // Ä°pucu bilgi modalini gÃ¶sterme fonksiyonu
        function showClueInfo(clue, roomId) {
            try {
                // Modal aÃ§Ä±lÄ±ÅŸ sesi Ã§al
                playSound('modal');
                
                // Modal elementlerini al
                const clueModal = document.getElementById('clueModal');
                const clueTitle = document.getElementById('clueTitle');
                const clueDescription = document.getElementById('clueDescription');
                const examineBtn = document.getElementById('examineBtn');
                
                // Hangi odanÄ±n ipucu olduÄŸunu belirt
                const roomElement = document.querySelector(`.room[data-room="${roomId}"]`);
                const roomName = roomElement ? roomElement.title : roomId;
                
                // Modal iÃ§eriÄŸini doldur
                clueTitle.textContent = clue.name;
                clueTitle.dataset.roomId = roomId; // Hangi odanÄ±n ipucu olduÄŸunu kaydet
                clueDescription.textContent = clue.description;
                
                // Ä°NCELE butonuna tÄ±klama olayÄ± ekle
                examineBtn.onclick = function() {
                    playSound('clueExamine');
                    window.location.href = clue.link;
                };
                
                // Modali gÃ¶ster
                clueModal.style.display = 'flex';
                
                // Modal dÄ±ÅŸÄ±na tÄ±klayÄ±nca kapatma
                clueModal.addEventListener('click', function(e) {
                    if (e.target === clueModal) {
                        clueModal.style.display = 'none';
                        playSound('modal'); // Modal kapanÄ±ÅŸ sesi
                    }
                });
            } catch (err) {
                console.error("showClueInfo hatasÄ±:", err);
                showCustomAlert("Ä°pucu bilgileri gÃ¶sterilirken bir hata oluÅŸtu.");
            }
        }
        
        // Zoom iÅŸlevleri
        function updateTransform() {
            zoomContainer.style.transform = `scale(${currentScale}) translate(${currentTranslateX}px, ${currentTranslateY}px)`;
        }
        
        function zoomIn() {
            if (currentScale < 3) {
                currentScale += 0.2;
                updateTransform();
            }
        }
        
        function zoomOut() {
            if (currentScale > 0.5) {
                currentScale -= 0.2;
                updateTransform();
            }
        }
        
        function resetZoom() {
            currentScale = 1;
            currentTranslateX = 0;
            currentTranslateY = 0;
            updateTransform();
        }
        
        // SÃ¼rÃ¼kleme (pan) iÅŸlevleri
        function startDrag(e) {
            // Sadece sol tÄ±klama ile sÃ¼rÃ¼kleme (fare iÃ§in)
            if (e.type === "mousedown" && e.button !== 0) return;
            
            // Sadece 1.2x zoom'dan sonra sÃ¼rÃ¼kleme izin ver
            if (currentScale > 1.1) {
                isDragging = true;
                
                if (e.type === "mousedown") {
                    startX = e.clientX;
                    startY = e.clientY;
                } else if (e.type === "touchstart") {
                    // Tek parmak dokunma ise sÃ¼rÃ¼kle
                    if (e.touches.length === 1) {
                        startX = e.touches[0].clientX;
                        startY = e.touches[0].clientY;
                    }
                }
                
                initialTranslateX = currentTranslateX;
                initialTranslateY = currentTranslateY;
                
                zoomContainer.style.cursor = 'grabbing';
                e.preventDefault();
            }
        }
        
        function drag(e) {
            if (!isDragging) return;
            
            let clientX, clientY;
            
            if (e.type === "mousemove") {
                clientX = e.clientX;
                clientY = e.clientY;
                e.preventDefault();
            } else if (e.type === "touchmove") {
                // Sadece tek parmak dokunma
                if (e.touches.length === 1) {
                    clientX = e.touches[0].clientX;
                    clientY = e.touches[0].clientY;
                    e.preventDefault();
                } else {
                    return;
                }
            } else {
                return;
            }
            
            const dx = (clientX - startX) / currentScale;
            const dy = (clientY - startY) / currentScale;
            
            currentTranslateX = initialTranslateX + dx;
            currentTranslateY = initialTranslateY + dy;
            
            updateTransform();
        }
        
        function endDrag() {
            isDragging = false;
            zoomContainer.style.cursor = 'default';
        }
        
        // Pinch-to-zoom
        let initialPinchDistance = 0;
        let initialScale = 1;
        
        function handlePinch(e) {
            if (e.touches.length !== 2) return;
            
            e.preventDefault();
            
            const touch1 = e.touches[0];
            const touch2 = e.touches[1];
            
            const distance = Math.hypot(
                touch1.clientX - touch2.clientX,
                touch1.clientY - touch2.clientY
            );
            
            if (initialPinchDistance === 0) {
                initialPinchDistance = distance;
                initialScale = currentScale;
                return;
            }
            
            const scaleFactor = distance / initialPinchDistance;
            let newScale = initialScale * scaleFactor;
            
            // Ã–lÃ§eÄŸi sÄ±nÄ±rla
            newScale = Math.min(Math.max(0.5, newScale), 3);
            
            // Yeni Ã¶lÃ§eÄŸi uygula
            currentScale = newScale;
            
            updateTransform();
        }
        
        function handlePinchEnd() {
            initialPinchDistance = 0;
        }
        
        // Modal dÄ±ÅŸÄ±na tÄ±klayÄ±nca kapatma
        searchModal.addEventListener('click', (e) => {
            if (e.target === searchModal) {
                searchModal.style.display = 'none';
                if (searchInterval) clearInterval(searchInterval);
                // Modal kapanma sesi Ã§al
                playSound('modal');
            }
        });
        
        // Kat deÄŸiÅŸtirme butonlarÄ±
        floorButtons.forEach(btn => {
            btn.addEventListener('click', () => {
                const floor = btn.dataset.floor;
                if (currentFloor != floor) {
                    // Kat deÄŸiÅŸtirme sesi Ã§al
                    playSound('floorChange');
                }
                switchFloor(floor);
            });
        });
        
        // Oda tÄ±klama olaylarÄ±
        rooms.forEach(room => {
            // Hover sesi
            room.addEventListener('mouseenter', function() {
                if (!this.classList.contains('disabled-room')) {
                    playSound('roomHover');
                }
            });
            
            room.addEventListener('click', function(e) {
                // EÄŸer sÃ¼rÃ¼kleme yapÄ±ldÄ±ysa tÄ±klamayÄ± engelle
                if (isDragging) return;
                
                const roomId = this.dataset.room;
                
                // EÄŸer oda devre dÄ±ÅŸÄ±ysa uyarÄ± sesi Ã§al
                if (this.classList.contains('disabled-room') && gameState.activeSearch) {
                    playSound('roomDisabled');
                    const activeRoomElement = document.querySelector(`.room[data-room="${gameState.activeSearch}"]`);
                    const activeRoomName = activeRoomElement ? activeRoomElement.title : gameState.activeSearch;
                    showCustomAlert(`Åu anda "${activeRoomName}" odasÄ±nda arama devam ediyor. AynÄ± anda sadece bir odada arama yapabilirsiniz.`);
                    return;
                }
                
                // TÄ±klama sesi Ã§al
                playSound('click');
                
                // EÄŸer oda tamamlanmÄ±ÅŸsa ipuÃ§larÄ±nÄ± gÃ¶ster
                if (gameState.completedSearches.includes(roomId)) {
                    currentRoomElement.textContent = this.title;
                    currentRoomElement.dataset.roomid = roomId; // Oda ID'sini kaydet
                    document.getElementById('searchConfirm').style.display = 'none';
                    document.getElementById('searchProgress').style.display = 'none';
                    document.getElementById('searchProgress').querySelector('.search-text').textContent = 'Arama tamamlandÄ±! Bulunan ipuÃ§larÄ±:';
                    createClues(roomId);
                    cluesContainer.style.display = 'flex';
                    searchModal.style.display = 'flex';
                    playSound('modal'); // Modal aÃ§Ä±lma sesi
                    return;
                }
                
                // EÄŸer bu oda aktif aramaysa, durumu gÃ¶ster
                if (gameState.activeSearch === roomId) {
                    prepareSearch(roomId);
                    return;
                }
                
                // EÄŸer oda devre dÄ±ÅŸÄ± bÄ±rakÄ±lmÄ±ÅŸsa ve aktif arama varsa uyarÄ± ver
                if (this.classList.contains('disabled-room') && gameState.activeSearch) {
                    playSound('alert'); // UyarÄ± sesi
                    const activeRoomElement = document.querySelector(`.room[data-room="${gameState.activeSearch}"]`);
                    const activeRoomName = activeRoomElement ? activeRoomElement.title : gameState.activeSearch;
                    showCustomAlert(`Åu anda "${activeRoomName}" odasÄ±nda arama devam ediyor. AynÄ± anda sadece bir odada arama yapabilirsiniz.`);
                    return;
                }
                
                // Oda henÃ¼z tamamlanmadÄ±ysa ve devre dÄ±ÅŸÄ± deÄŸilse arama hazÄ±rlÄ±ÄŸÄ±nÄ± baÅŸlat
                prepareSearch(roomId);
            });
        });
        
        // Mobil tÄ±klama algÄ±lama geliÅŸtirmeleri
        rooms.forEach(room => {
            room.addEventListener('touchstart', function(e) {
                // SÃ¼rÃ¼kleme olayÄ±nÄ± engelleme
                e.stopPropagation();
            }, { passive: false });
            
            room.addEventListener('touchend', function(e) {
                // EÄŸer sÃ¼rÃ¼kleme yapÄ±ldÄ±ysa tÄ±klamayÄ± engelle
                if (isDragging) return;
                
                const roomId = this.dataset.room;
                
                // EÄŸer oda devre dÄ±ÅŸÄ±ysa uyarÄ± sesi Ã§al
                if (this.classList.contains('disabled-room') && gameState.activeSearch) {
                    playSound('roomDisabled');
                    return;
                }
                
                // TÄ±klama sesi Ã§al
                playSound('click');
                
                // EÄŸer oda tamamlanmÄ±ÅŸsa ipuÃ§larÄ±nÄ± gÃ¶ster
                if (gameState.completedSearches.includes(roomId)) {
                    currentRoomElement.textContent = this.title;
                    currentRoomElement.dataset.roomid = roomId; // Oda ID'sini kaydet
                    document.getElementById('searchConfirm').style.display = 'none';
                    document.getElementById('searchProgress').style.display = 'none';
                    document.getElementById('searchProgress').querySelector('.search-text').textContent = 'Arama tamamlandÄ±! Bulunan ipuÃ§larÄ±:';
                    createClues(roomId);
                    cluesContainer.style.display = 'flex';
                    searchModal.style.display = 'flex';
                    playSound('modal'); // Modal aÃ§Ä±lma sesi
                    return;
                }
                
                // EÄŸer bu oda aktif aramaysa, durumu gÃ¶ster
                if (gameState.activeSearch === roomId) {
                    prepareSearch(roomId);
                    return;
                }
                
                // EÄŸer oda devre dÄ±ÅŸÄ± bÄ±rakÄ±lmÄ±ÅŸsa ve aktif arama varsa uyarÄ± ver
                if (this.classList.contains('disabled-room') && gameState.activeSearch) {
                    playSound('alert'); // UyarÄ± sesi
                    const activeRoomElement = document.querySelector(`.room[data-room="${gameState.activeSearch}"]`);
                    const activeRoomName = activeRoomElement ? activeRoomElement.title : gameState.activeSearch;
                    showCustomAlert(`Åu anda "${activeRoomName}" odasÄ±nda arama devam ediyor. AynÄ± anda sadece bir odada arama yapabilirsiniz.`);
                    return;
                }
                
                // Oda henÃ¼z tamamlanmadÄ±ysa ve devre dÄ±ÅŸÄ± deÄŸilse arama hazÄ±rlÄ±ÄŸÄ±nÄ± baÅŸlat
                prepareSearch(roomId);
                
                e.preventDefault();
            }, { passive: false });
        });
        
        // Zoom butonlarÄ±
        zoomInBtn.addEventListener('click', function() {
            playSound('click'); // TÄ±klama sesi
            zoomIn();
        });
        
        zoomOutBtn.addEventListener('click', function() {
            playSound('click'); // TÄ±klama sesi
            zoomOut();
        });
        
        zoomResetBtn.addEventListener('click', function() {
            playSound('click'); // TÄ±klama sesi
            resetZoom();
        });
        
        // Mobil iÃ§in zoom butonlarÄ±
        zoomInBtn.addEventListener('touchend', function(e) {
            e.preventDefault();
            playSound('click'); // TÄ±klama sesi
            zoomIn();
        });
        
        zoomOutBtn.addEventListener('touchend', function(e) {
            e.preventDefault();
            playSound('click'); // TÄ±klama sesi
            zoomOut();
        });
        
        zoomResetBtn.addEventListener('touchend', function(e) {
            e.preventDefault();
            playSound('click'); // TÄ±klama sesi
            resetZoom();
        });
        
        // SÃ¼rÃ¼kleme olaylarÄ±
        zoomContainer.addEventListener('mousedown', startDrag);
        document.addEventListener('mousemove', drag);
        document.addEventListener('mouseup', endDrag);
        document.addEventListener('mouseleave', endDrag);
        
        // Mobil dokunma olaylarÄ±
        zoomContainer.addEventListener('touchstart', startDrag, { passive: false });
        document.addEventListener('touchmove', drag, { passive: false });
        document.addEventListener('touchend', endDrag);
        
        // Pinch-to-zoom olaylarÄ±
        document.addEventListener('touchstart', function(e) {
            if (e.touches.length === 2) {
                initialPinchDistance = 0;
                e.preventDefault();
            }
        }, { passive: false });
        
        document.addEventListener('touchmove', handlePinch, { passive: false });
        document.addEventListener('touchend', handlePinchEnd);
        
        // VarsayÄ±lan olarak 1. katÄ± gÃ¶ster
        switchFloor(1);

        // ===== Ä°PUÃ‡LARI TANIMLARI =====
        // NOT: OdalarÄ±n iÃ§inde bulunan ipuÃ§larÄ±nÄ±n tanÄ±mlamalarÄ± burada yapÄ±lÄ±r.
        // Her ipucu iÃ§in ÅŸu bilgileri dÃ¼zenleyebilirsiniz:
        // - name: Ä°pucunun adÄ±/baÅŸlÄ±ÄŸÄ±
        // - image: Ä°pucuna ait gÃ¶rselin dosya adÄ±
        // - link: Ä°pucu tÄ±klandÄ±ÄŸÄ±nda yÃ¶nlendirilecek mini oyun/sayfa linki 
        // - description: Ä°pucuyla ilgili aÃ§Ä±klama metni
        const roomClues = {
            'salon': [ // Salon ipuÃ§larÄ±
                { 
                    name: 'Kanepe', // NOT: Ä°pucu adÄ±nÄ± buradan deÄŸiÅŸtirebilirsiniz
                    image: 'kanit_kanepe.jpg', // NOT: Ä°pucu gÃ¶rselini buradan deÄŸiÅŸtirebilirsiniz 
                    link: 'minigame1.html', // NOT: YÃ¶nlendirme linkini buradan deÄŸiÅŸtirebilirsiniz
                    description: 'Salondaki kanepenin yastÄ±klarÄ±nÄ±n altÄ±nda bazÄ± eÅŸyalar bulundu. Kanepe Ã¼zerindeki kan izleri ve diÄŸer lekelerin detaylÄ± incelemesi gerekiyor. Kanepede bulunan uzun sarÄ± saÃ§lar kime ait olabilir?' // NOT: Ä°pucu aÃ§Ä±klamasÄ±nÄ± buradan deÄŸiÅŸtirebilirsiniz
                },
                { 
                    name: 'Televizyon', 
                    image: 'kanit_tv.jpg', 
                    link: 'minigame2.html',
                    description: 'Televizyonun Ã¼zerinde parmak izleri tespit edildi. AyrÄ±ca televizyondaki gÃ¼venlik kamerasÄ± kayÄ±tlarÄ± cinayetin iÅŸlendiÄŸi gece hakkÄ±nda Ã¶nemli bilgiler iÃ§eriyor olabilir. KayÄ±tlarÄ± incelemek iÃ§in ÅŸifre gerekiyor.'
                }
            ],
            'mutfak': [ // Mutfak ipuÃ§larÄ±
                { 
                    name: 'BuzdolabÄ±', 
                    image: 'kanit_buzdolabi.jpg', 
                    link: 'minigame3.html',
                    description: 'BuzdolabÄ±nda yarÄ±m kalmÄ±ÅŸ bir ÅŸiÅŸe ÅŸarap ve iki kadeh bulundu. ÅiÅŸenin Ã¼zerinde parmak izleri var. BuzdolabÄ±nÄ±n iÃ§inde ayrÄ±ca ÅŸÃ¼pheli bir ilaÃ§ ÅŸiÅŸesi tespit edildi. Ä°ncelenmesi gerekiyor.'
                },
                { 
                    name: 'BÄ±Ã§ak Ã‡ekmecesi', 
                    image: 'kanit_bicak.jpg', 
                    link: 'minigame4.html',
                    description: 'Mutfak Ã§ekmecesindeki bÄ±Ã§ak setinden bir adet ekmek bÄ±Ã§aÄŸÄ± eksik. DiÄŸer bÄ±Ã§aklarÄ±n Ã¼zerinde kan izleri kontrolÃ¼ yapÄ±lmalÄ±. Ã‡ekmecenin kulpunda birden fazla kiÅŸiye ait parmak izleri tespit edildi.'
                }
            ],
            'calisma': [ // Ã‡alÄ±ÅŸma odasÄ± ipuÃ§larÄ±
                { 
                    name: 'Kasa', 
                    image: 'kanit_kasa.jpg', 
                    link: 'kasa.html',
                    description: 'Ã‡alÄ±ÅŸma odasÄ±ndaki kasa, Fikret Bey\'e ait. Ä°Ã§inde Ã¶nemli belgeler ve deÄŸerli eÅŸyalar olduÄŸu biliniyor. Kasa ÅŸifresini bulmak iÃ§in odadaki ipuÃ§larÄ±nÄ± incelemen gerekiyor. KasanÄ±n Ã¼zerinde parmak izleri bulundu.'
                },
                { 
                    name: 'Bilgisayar', 
                    image: 'kanit_pc.jpg', 
                    link: 'minigame5.html',
                    description: 'Bilgisayarda Fikret Bey\'in son dÃ¶nemde yaptÄ±ÄŸÄ± araÅŸtÄ±rmalar ve yazÄ±ÅŸmalar bulunuyor. E-postalarÄ±nda ÅŸÃ¼pheli yazÄ±ÅŸmalar dikkat Ã§ekiyor. Bilgisayar ÅŸifreli, ancak masadaki notlar ÅŸifreyi Ã§Ã¶zmek iÃ§in ipuÃ§larÄ± iÃ§eriyor.'
                }
            ],
            'yemek': [ // Yemek odasÄ± ipuÃ§larÄ±
                { 
                    name: 'Ã‡ekmece', 
                    image: 'kanit_cekmece_yemek.jpg', 
                    link: 'minigame6.html',
                    description: 'Yemek odasÄ±ndaki Ã§ekmecede bir miras belgesi bulundu. Belge Ã¼zerinde yapÄ±lan deÄŸiÅŸiklikler dikkat Ã§ekici. Ã‡ekmecenin arka kÄ±smÄ±nda gizlenmiÅŸ bir not bulundu. Not, ailenin bir sÄ±rrÄ±nÄ± ortaya Ã§Ä±karabilir.'
                }
            ],
            // NOT: Yeni ipuÃ§larÄ± eklemek isterseniz aÅŸaÄŸÄ±daki formatta ekleyebilirsiniz
            // 'oda_adi': [
            //    { 
            //        name: 'Ä°pucu AdÄ±', 
            //        image: 'ipucu_resmi.jpg', 
            //        link: 'mini_oyun.html',
            //        description: 'Ä°pucu aÃ§Ä±klamasÄ± buraya gelecek.'
            //    }
            // ],
            'hamdi': [ // Hamdi'nin odasÄ± ipuÃ§larÄ±
                { 
                    name: 'Ã‡ekmece', 
                    image: 'kanit_cekmece_yemek.jpg', 
                    link: 'minigame6.html',
                    description: 'Hamdi\'nin odasÄ±ndaki Ã§ekmecede bir miras belgesi bulundu. Belge Ã¼zerinde yapÄ±lan deÄŸiÅŸiklikler dikkat Ã§ekici. Ã‡ekmecenin arka kÄ±smÄ±nda gizlenmiÅŸ bir not bulundu. Not, ailenin bir sÄ±rrÄ±nÄ± ortaya Ã§Ä±karabilir.'
                }
            ],
            'nalan': [ // Nalan'Ä±n odasÄ± ipuÃ§larÄ±
                { 
                    name: 'Dolap', 
                    image: 'kanit_dolap.jpg', 
                    link: 'minigame7.html',
                    description: 'Nalan\'Ä±n dolabÄ±nda yabancÄ± bir erkek parfÃ¼mÃ¼ ve bazÄ± ÅŸÃ¼pheli belgeler bulundu. DolabÄ±n arka kÄ±smÄ±nda gizlenmiÅŸ bir gÃ¼nlÃ¼k var. GÃ¼nlÃ¼kte Ã¶nemli ipuÃ§larÄ± olabilir.'
                },
                { 
                    name: 'YataÄŸÄ±n AltÄ±', 
                    image: 'kanit_yatak.jpg', 
                    link: 'minigame8.html',
                    description: 'YataÄŸÄ±n altÄ±nda gizlenmiÅŸ bir Ã§anta iÃ§inde yÃ¼klÃ¼ miktarda para bulundu. ParanÄ±n kaynaÄŸÄ± ÅŸÃ¼pheli. AyrÄ±ca bir silah kutusu da tespit edildi, ancak iÃ§i boÅŸtu.'
                }
            ],
            'elif': [ // Elif'in odasÄ± ipuÃ§larÄ±
                { 
                    name: 'Makyaj MasasÄ±', 
                    image: 'kanit_makyaj.jpg', 
                    link: 'minigame9.html',
                    description: 'Elif\'in makyaj masasÄ±nda birkaÃ§ fotoÄŸraf ve bir mektup bulundu. FotoÄŸraflarda ailede olmayan bir kiÅŸi gÃ¶rÃ¼lÃ¼yor. Makyaj malzemelerinin arasÄ±nda gizlenmiÅŸ bir USB bellek dikkat Ã§ekiyor.'
                }
            ],
            'asli': [ // AslÄ±'nÄ±n odasÄ± ipuÃ§larÄ±
                { 
                    name: 'KitaplÄ±k', 
                    image: 'kanit_kitaplik.jpg', 
                    link: 'minigame10.html',
                    description: 'AslÄ±\'nÄ±n kitaplÄ±ÄŸÄ±nda zehirler ve toksikoloji hakkÄ±nda birÃ§ok kitap bulundu. KitaplarÄ±n bazÄ± sayfalarÄ± iÅŸaretlenmiÅŸ durumda. "Tespit Edilemeyen Zehirler" konulu kitaptaki notlar Ã¶zellikle dikkat Ã§ekiyor.'
                },
                { 
                    name: 'Ã‡ekmece', 
                    image: 'kanit_cekmece_asli.jpg', 
                    link: 'minigame11.html',
                    description: 'AslÄ±\'nÄ±n Ã§ekmecesinde tÄ±p fakÃ¼ltesinden arkadaÅŸlarÄ±yla Ã§ekilmiÅŸ fotoÄŸraflar ve bazÄ± ilaÃ§ prospektÃ¼sleri bulundu. AyrÄ±ca laboratuvar eriÅŸimi iÃ§in bir kart ve ÅŸifreli notlar dikkat Ã§ekiyor.'
                }
            ],
            'sercan': [ // Sercan'Ä±n odasÄ± ipuÃ§larÄ±
                { 
                    name: 'Spor Ã‡antasÄ±', 
                    image: 'kanit_canta.jpg', 
                    link: 'minigame12.html',
                    description: 'Sercan\'Ä±n spor Ã§antasÄ±nda normalde spor salonunda kullanÄ±lmayacak bazÄ± eÅŸyalar tespit edildi. Ã‡antanÄ±n gizli bÃ¶lmesinde borÃ§ senetleri ve bir tehdit mektubu bulundu. AyrÄ±ca ekmek bÄ±Ã§aÄŸÄ±na benzeyen bir bÄ±Ã§ak da dikkat Ã§ekiyor.'
                }
            ],
            'fikret': [ // Fikret'in odasÄ± ipuÃ§larÄ±
                { 
                    name: 'Gizli BÃ¶lme', 
                    image: 'kanit_gizli.jpg', 
                    link: 'minigame13.html',
                    description: 'Fikret\'in odasÄ±nda duvarÄ±n arkasÄ±nda bir gizli bÃ¶lme keÅŸfedildi. BÃ¶lmede aile Ã¼yelerine ait Ã¶zel bilgiler, ÅŸantaj belgeleri ve bÃ¼yÃ¼k miktarda nakit para bulunuyor. Belgelerin bazÄ±larÄ± Ã¼zerinde kan lekeleri var.'
                }
            ]
        };

        // ===== ODA DURUMLARINI GÃœNCELLEME =====
        // NOT: Bu fonksiyon, aktif arama varsa diÄŸer odalarÄ± devre dÄ±ÅŸÄ± bÄ±rakÄ±r
        function updateRoomStates() {
            try {
                console.log("Oda durumlarÄ± gÃ¼ncelleniyor... Aktif arama:", gameState.activeSearch);
                // TÃ¼m odalarÄ± normal haline getir
                rooms.forEach(room => {
                    room.style.opacity = '1';
                    room.style.cursor = 'pointer';
                    room.classList.remove('disabled-room');
                    // TÃ¼m event listener'larÄ± aktif et
                    room.style.pointerEvents = 'auto';
                });

                // Aktif arama varsa diÄŸer odalarÄ± devre dÄ±ÅŸÄ± bÄ±rak
                if (gameState.activeSearch) {
                    rooms.forEach(room => {
                        const roomId = room.dataset.room;
                        
                        // TamamlanmÄ±ÅŸ odalar ve aktif arama dÄ±ÅŸÄ±ndaki odalarÄ± devre dÄ±ÅŸÄ± bÄ±rak
                        if (!gameState.completedSearches.includes(roomId) && roomId !== gameState.activeSearch) {
                            room.style.opacity = '0.5';
                            room.style.cursor = 'not-allowed';
                            room.classList.add('disabled-room');
                        }
                    });
                }
            } catch (err) {
                console.error("updateRoomStates hatasÄ±:", err);
            }
        }

        // OdanÄ±n adÄ±nÄ± deÄŸiÅŸtirdiÄŸimizde room mapini gÃ¼ncelleme fonksiyonu
        function updateRoomMappings() {
            try {
                // TÃ¼m odalarÄ± seÃ§in
                const rooms = document.querySelectorAll('.room');
                
                // Her oda iÃ§in kontrol et
                rooms.forEach(room => {
                    const roomId = room.dataset.room;
                    const roomTitle = room.getAttribute('title') || '';
                    
                    // Oda baÅŸlÄ±ÄŸÄ± deÄŸiÅŸtirilmiÅŸ mi kontrol et - Hamdi odasÄ± Ã¶rneÄŸi
                    if (roomId === 'yemek' && roomTitle.toLowerCase().includes('hamdi')) {
                        console.log("Yemek odasÄ± iÃ§in baÅŸlÄ±k deÄŸiÅŸimi tespit edildi, veri gÃ¼ncelleniyor...");
                        room.dataset.room = 'hamdi';
                        
                        // roomClues nesnesindeki ipuÃ§larÄ±nÄ±n doÄŸru gÃ¶sterildiÄŸinden emin olalÄ±m
                        updateRoomEvidenceDisplay('hamdi');
                    }
                });
                
                console.log("Oda eÅŸlemeleri gÃ¼ncellendi.");
            } catch (err) {
                console.error("Oda eÅŸleme hatasÄ±:", err);
            }
        }

        // Bir odadaki kanÄ±tlarÄ± doÄŸru ÅŸekilde gÃ¶rÃ¼ntÃ¼leme fonksiyonu
        function updateRoomEvidenceDisplay(roomId) {
            try {
                // Aktif arama bu oda iÃ§in mi kontrol et
                const gameState = loadGameState();
                if (gameState.activeSearch === roomId || gameState.completedSearches.includes(roomId)) {
                    // Bu oda iÃ§in kanÄ±tlar varsa
                    if (roomClues[roomId] && roomClues[roomId].length > 0) {
                        // KanÄ±t listesini temizle ve yeniden oluÅŸtur
                        const evidenceList = document.getElementById('evidenceList');
                        if (evidenceList) {
                            evidenceList.innerHTML = '';
                            
                            roomClues[roomId].forEach(clue => {
                                const clueItem = document.createElement('div');
                                clueItem.className = 'evidence-item';
                                clueItem.innerHTML = `
                                    <img src="${clue.image}" alt="${clue.name}">
                                    <h3>${clue.name}</h3>
                                    <p>${clue.description}</p>
                                    <a href="${clue.link}" class="btn">Ä°ncele</a>
                                `;
                                evidenceList.appendChild(clueItem);
                            });
                        }
                    }
                }
            } catch (err) {
                console.error("KanÄ±t gÃ¶sterme hatasÄ±:", err);
            }
        }

        // Yerel depo verilerini temizleme ve oda kimliklerini dÃ¼zeltme fonksiyonu
        function fixRoomIdMismatch() {
            try {
                // Yemek odasÄ±nÄ± kontrol et ve gerekirse gÃ¼ncelle
                const yemekOdasi = document.querySelector('.room[data-room="yemek"]');
                // Hamdi odasÄ± var mÄ± kontrol et
                const hamdiOdasi = document.querySelector('.room[data-room="hamdi"]');
                
                // EÄŸer yemek odasÄ± Hamdi odasÄ± olarak deÄŸiÅŸtirildiyse ve HTML'de yeni kimlik yok ise
                if (yemekOdasi && yemekOdasi.title.toLowerCase().includes('hamdi') && !hamdiOdasi) {
                    console.log("Yemek odasÄ± Hamdi'nin odasÄ± olarak deÄŸiÅŸtirilmiÅŸ, dÃ¼zeltiliyor...");
                    yemekOdasi.dataset.room = "hamdi"; // HTML'de data-room Ã¶zelliÄŸini gÃ¼ncelle
                    
                    // Oyun durumunu gÃ¼ncelle
                    const gameState = loadGameState();
                    
                    // TamamlanmÄ±ÅŸ aramalar listesini gÃ¼ncelle
                    if (gameState.completedSearches.includes('yemek')) {
                        // Yemek odasÄ±nÄ± kaldÄ±r
                        gameState.completedSearches = gameState.completedSearches.filter(id => id !== 'yemek');
                        // Hamdi odasÄ±nÄ± ekle (eÄŸer zaten yoksa)
                        if (!gameState.completedSearches.includes('hamdi')) {
                            gameState.completedSearches.push('hamdi');
                        }
                    }
                    
                    // Arama kayÄ±tlarÄ±nÄ± gÃ¼ncelle
                    if (gameState.searchedRooms.yemek) {
                        // Hamdi odasÄ± iÃ§in arama kaydÄ± oluÅŸtur
                        gameState.searchedRooms.hamdi = gameState.searchedRooms.yemek;
                        // Yemek odasÄ± kaydÄ±nÄ± sil
                        delete gameState.searchedRooms.yemek;
                    }
                    
                    // Aktif arama gÃ¼ncellemesi
                    if (gameState.activeSearch === 'yemek') {
                        gameState.activeSearch = 'hamdi';
                    }
                    
                    // DeÄŸiÅŸiklikleri kaydet
                    saveGameState(gameState);
                    console.log("Oda kimlik dÃ¼zeltmesi tamamlandÄ±.");
                }
            } catch (err) {
                console.error("Oda ID dÃ¼zeltme hatasÄ±:", err);
            }
        }

        // Sayfa yÃ¼klendiÄŸinde oda maplemesini kontrol et
        window.addEventListener('load', function() {
            // Mobil dokunma olaylarÄ±nÄ± dÃ¼zelt
            fixTouchEvents();
            
            // Oda ID sorunlarÄ±nÄ± dÃ¼zelt
            fixRoomIdMismatch();
            
            // Oda eÅŸlemelerini kontrol et
            updateRoomMappings();
            
            const savedPlayer = localStorage.getItem(PLAYER_KEY);
            const savedGameStart = localStorage.getItem(GAME_START_KEY);
            
            // EÄŸer daha Ã¶nce oyuna baÅŸlamÄ±ÅŸsa
            if (savedPlayer && savedGameStart) {
                document.getElementById('playerName').value = savedPlayer;
                document.getElementById('playerNameDisplay').textContent = savedPlayer;
                gameStartTime = parseInt(savedGameStart);
                
                // Otomatik olarak oyunu baÅŸlat
                document.getElementById('splashScreen').style.display = 'none';
                document.getElementById('gameContainer').style.display = 'block';
                
                // EkranÄ± uyanÄ±k tutmayÄ± dene (gÃ¼venli)
                try {
                    requestWakeLock();
                } catch (err) {
                    console.log("WakeLock hatasÄ± (Ã¶nemsiz):", err);
                }
                
                // Oyun sayacÄ±nÄ± baÅŸlat
                startGameTimer();
                
                // Oyun durumunu yÃ¼kle
                loadGameState();
                
                // OdalarÄ±n durumlarÄ±nÄ± gÃ¼ncelle
                updateRoomStates();
                
                // Kesintiye uÄŸramÄ±ÅŸ aramalarÄ± kontrol et
                checkPendingSearches();
            }
            
            // Sayfa gÃ¶rÃ¼nÃ¼rlÃ¼k deÄŸiÅŸikliÄŸini izle (sekme/uygulama deÄŸiÅŸtirme, vb.)
            document.addEventListener('visibilitychange', function() {
                if (document.visibilityState === 'visible') {
                    // EkranÄ± tekrar kilitle (gÃ¼venli)
                    try {
                        requestWakeLock();
                    } catch (err) {
                        console.log("WakeLock hatasÄ± (Ã¶nemsiz):", err);
                    }
                    
                    // AramalarÄ± kontrol et
                    checkPendingSearches();
                    
                    // OdalarÄ±n durumlarÄ±nÄ± gÃ¼ncelle
                    updateRoomStates();
                    
                    // Oyun sÃ¼resini gÃ¼ncelle
                    updateGameTime();
                }
            });
        });
    </script>
    
    <!-- Service Worker KaydÄ± Ä°Ã§in Script -->
    <script>
    // service-worker.js dosyasÄ±nÄ± oluÅŸturmak iÃ§in kod
    function createServiceWorkerScript() {
        try {
            // Service Worker API kontrolÃ¼
            if (!('serviceWorker' in navigator)) {
                console.log('Service Worker desteklenmiyor. Normal ÅŸekilde devam ediliyor.');
                return;
            }

            // Sayfa yÃ¼klendiÄŸinde sw.js dosyasÄ±nÄ± oluÅŸtur
            window.addEventListener('load', function() {
                const swContent = `
                // Service Worker
                const CACHE_NAME = 'villa13-cache-v1';
                const urlsToCache = [
                    '/',
                    '/villa13.html',
                    '/villa_1kat.jpg',
                    '/villa_2kat.jpg',
                    '/kanit_default.jpg',
                    '/kanit_kanepe.jpg',
                    '/kanit_tv.jpg',
                    '/kanit_buzdolabi.jpg',
                    '/kanit_bicak.jpg',
                    '/kanit_kasa.jpg',
                    '/kanit_pc.jpg',
                    '/kanit_cekmece_yemek.jpg',
                    '/kanit_dolap.jpg',
                    '/kanit_yatak.jpg',
                    '/kanit_makyaj.jpg',
                    '/kanit_kitaplik.jpg',
                    '/kanit_cekmece_asli.jpg',
                    '/kanit_canta.jpg',
                    '/kanit_gizli.jpg'
                ];
                
                self.addEventListener('install', function(event) {
                    event.waitUntil(
                        caches.open(CACHE_NAME)
                            .then(function(cache) {
                                console.log('Cache aÃ§Ä±ldÄ±');
                                return cache.addAll(urlsToCache);
                            })
                    );
                });
                
                self.addEventListener('fetch', function(event) {
                    event.respondWith(
                        caches.match(event.request)
                            .then(function(response) {
                                if (response) {
                                    return response;
                                }
                                return fetch(event.request);
                            }
                        )
                    );
                });
                
                self.addEventListener('push', function(event) {
                    const title = 'Villa13';
                    const options = {
                        body: event.data ? event.data.text() : 'Yeni bir bildirim var!',
                        icon: 'https://placehold.co/192x192/333/white?text=V13',
                        vibrate: [200, 100, 200]
                    };
                    
                    event.waitUntil(
                        self.registration.showNotification(title, options)
                    );
                });
                
                self.addEventListener('notificationclick', function(event) {
                    event.notification.close();
                    event.waitUntil(
                        clients.openWindow('https://moneuphorian.github.io/villa13.html')
                    );
                });
                `;
                
                try {
                    // Blob oluÅŸtur
                    const blob = new Blob([swContent], {type: 'application/javascript'});
                    
                    // Blob URL oluÅŸtur
                    const blobURL = URL.createObjectURL(blob);
                    
                    // Service Worker'Ä± kaydet
                    navigator.serviceWorker.register(blobURL)
                        .then(function(registration) {
                            console.log('ServiceWorker kaydÄ± baÅŸarÄ±lÄ±:', registration.scope);
                            
                            // Bildirim izni iste (gÃ¼venli)
                            if (typeof Notification !== 'undefined') {
                                try {
                                    Notification.requestPermission().then(function(permission) {
                                        if (permission === 'granted') {
                                            console.log('Bildirim izni verildi');
                                        }
                                    }).catch(err => {
                                        console.log('Bildirim izni hatasÄ± (Ã¶nemsiz):', err);
                                    });
                                } catch (err) {
                                    console.log('Notification API hatasÄ± (Ã¶nemsiz):', err);
                                }
                            }
                        })
                        .catch(function(error) {
                            console.log('ServiceWorker kaydÄ± baÅŸarÄ±sÄ±z (Ã¶nemsiz):', error);
                        });
                } catch (err) {
                    console.log('SW oluÅŸturma hatasÄ± (Ã¶nemsiz):', err);
                }
            });
        } catch (err) {
            console.log('Service Worker skripti hatasÄ± (Ã¶nemsiz):', err);
        }
    }
    
    // Service Worker oluÅŸturma iÅŸlemini baÅŸlat
    createServiceWorkerScript();
    </script>
</body>
</html> 
